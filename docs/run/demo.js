/*!
 * vollgas logic gate circuit simulator
 * Copyright (C) Martin Exner
 * 
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published
 * by the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 * 
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */!function(e){var t={};function r(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=43)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(38),s=r(5),n=!1;class a extends s.StubGraphicalElement{constructor(e,t=!1,r=1){super(e),this.initialValue=t,this.num=r,this.lines=[]}static getHeightMultiplicator(e){return 1+Math.sqrt(Math.log2(e))}static getDrawableOutputValueFromReaders(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r]()?1:0;return t/e.length}static getLineColor(e){return 65536*Math.floor(a.LOW_R+e*(a.HIGH_R-a.LOW_R))+256*Math.floor(a.LOW_G+e*(a.HIGH_G-a.LOW_G))+Math.floor(a.LOW_B+e*(a.HIGH_B-a.LOW_B))}getDefaultHeight(){return Math.ceil(a.DEFAULT_HEIGHT*a.getHeightMultiplicator(this.num))}makeConnectorCoordinates(e){}makeBaseCoordinates(e,t){return{x:0,y:0}}makeElement(e,t){this.lines&&!this.lines.length||(this.lines=[]);let r=0;for(let e=t.length-1;e>0;e--){let i=t[e],s=t[e-1],n=s.x-i.x,a=s.y-i.y,o=Math.sqrt(Math.pow(n,2)+Math.pow(a,2)),l=r;r+=o,this.lines.push({from:i,xDelta:n,yDelta:a,fromProgress:l,toProgress:r,coversProgress:o})}for(let e of this.lines)e.fromProgress/=r,e.toProgress/=r,e.coversProgress/=r;let s=a.DELAY_PER_PIXEL>0?Math.max(Math.floor(a.DELAY_PER_PIXEL*r),1):0;return new i.Wire(this.getName(),s,this.initialValue,this.num)}makeGraphics(e,t,r){if(this.lineWidth=e,this.dataSource=r,this.element.getDelay()){this.delayBufferValueReaders=new Array(this.element.getNumOutputs());for(let e=0;e<this.delayBufferValueReaders.length;e++)this.delayBufferValueReaders[e]=r.getAddressValueReader(this.element.getDelayBufferAddressProvider(e)())}this.outputValueReaders=new Array(this.element.getNumOutputs());for(let e=0;e<this.outputValueReaders.length;e++)this.outputValueReaders[e]=r.getAddressValueReader(this.element.getOutputValueAddressProvider(e)());return new PIXI.Graphics}getDrawableOutputValue(){let e=0;for(let t=0;t<this.outputValueReaders.length;t++)e+=this.outputValueReaders[t]()?1:0;return e/this.outputValueReaders.length}getDrawableDelayBufferValue(e){let t=0;for(let r=0;r<this.delayBufferValueReaders.length;r++)t+=this.delayBufferValueReaders[r](e)?1:0;return t/this.delayBufferValueReaders.length}redraw(e){let t=0,r=this.lines[t];this.graphics.clear(),this.graphics.moveTo(r.from.x,r.from.y);let i=this.element.getDelay(),s=this.getDrawableOutputValue();for(let o=0;o<i;o++){let l=(o+(1-e))/i,u=this.getDrawableDelayBufferValue(o);if(u!==s||n){if(n){const e=o%2!=0;this.graphics.lineStyle(this.lineWidth,s>0?e?a.HIGH_BRIGHT_COLOR:a.HIGH_COLOR:e?a.LOW_BRIGHT_COLOR:a.LOW_COLOR,1)}else this.graphics.lineStyle(this.lineWidth,a.getLineColor(s),1);for(;l>r.toProgress;)t++,r=this.lines[t],this.graphics.lineTo(r.from.x,r.from.y);let e=(l-r.fromProgress)/r.coversProgress,i=r.from.x+r.xDelta*e,u=r.from.y+r.yDelta*e;this.graphics.lineTo(i,u)}s=u}n?this.graphics.lineStyle(this.lineWidth,s>0?a.HIGH_DARK_COLOR:a.LOW_DARK_COLOR,1):this.graphics.lineStyle(this.lineWidth,a.getLineColor(s),1);do{r=this.lines[t],this.graphics.lineTo(r.from.x+r.xDelta,r.from.y+r.yDelta)}while(++t<this.lines.length)}}t.GraphicalWire=a,function(e){e.DEFAULT_DELAY_PER_WINDOW_HEIGHT=100,e.DELAY_PER_PIXEL=0,e.DEFAULT_HEIGHT=2,e.DEFAULT_DISTANCE=3,e.DEFAULT_BUS_DISTANCE=10,e.DEFAULT_ELEMENT_DISTANCE=20,e.HIGH_R=0,e.HIGH_G=216,e.HIGH_B=10,e.HIGH_COLOR=e.HIGH_R<<16|e.HIGH_G<<8|e.HIGH_B,e.HIGH_DARK_COLOR=34816,e.HIGH_BRIGHT_COLOR=8978312,e.LOW_R=132,e.LOW_G=0,e.LOW_B=0,e.LOW_COLOR=e.LOW_R<<16|e.LOW_G<<8|e.LOW_B,e.LOW_DARK_COLOR=8912896,e.LOW_BRIGHT_COLOR=16746632}(a=t.GraphicalWire||(t.GraphicalWire={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(3),s=r(7),n=r(0);class a extends i.CompactCombinedGraphicalElement{constructor(e,t,r=!1,i=a.DEFAULT_HEIGHT,n=!1,o=!1){super(e,s.GraphicalNor.DEFAULT_HEIGHT,r),this.numInputs=t,this.defaultHeight=i,this.mirrorConnectors=n,this.initialValue=o}static getWidth(e){return Math.floor(3*e/4)}static getLineWidth(e){return Math.ceil(e/24)}static makeConnectorCoordinates(e,t,r,i=1,s=!1){let n=new Array(r);for(let r=0;r<n.length;r++)n[r]={x:s?e:0,y:(r+1)*t/(n.length+1)};let a=new Array(i);for(let r=0;r<a.length;r++)a[r]={x:s?0:e,y:(r+1)*t/(a.length+1)};return{input:n,output:a}}static makeGraphics(e,t,r="≥1",i,s=0){let n=new PIXI.Graphics;if(r){void 0===i&&(i=e);let o=new PIXI.Text(r,{fontSize:2*i/5,fontFamily:"Arial",fill:a.TEXT_COLOR});o.anchor.set(.5,.5),o.x=t/2+s,o.y=e/2,n.addChild(o)}return n}static redraw(e,t,r,i,s){e.clear(),e.lineStyle(i,s,1),e.drawRect(0,0,t,r)}makeDefaultHeight(){return this.defaultHeight}makeWiringDescriptions(){let e=new Array(this.numInputs);for(let t=0;t<e.length;t++)e[t]={name:"outside",outputIndex:t};return[{name:"nor1",element:new s.GraphicalNor("nor1",this.numInputs,!this.initialValue),height:"auto",inputs:e,externalOutputs:[],coordinates:[{x:0,y:0}]},{name:"nor2",element:new s.GraphicalNor("nor2",1,this.initialValue),height:"auto",inputs:[{name:"wire",outputIndex:0}],externalOutputs:[0],coordinates:[{x:{delta:20,from:{name:"nor1",connector:"output",index:0}},y:0}]},{name:"wire",element:new n.GraphicalWire("wire",!this.initialValue),height:"auto",inputs:[{name:"nor1",outputIndex:0}],externalOutputs:[],coordinates:[{name:"nor1",connector:"output",index:0},{name:"nor2",connector:"input",index:0}]}]}makeConnectorCoordinates(e){this.height=e;let t=e/this.makeDefaultHeight();return this.width=a.getWidth(t*a.DEFAULT_HEIGHT),this.lineWidth=a.getLineWidth(t*a.DEFAULT_HEIGHT),a.makeConnectorCoordinates(this.width,this.height,this.numInputs,1,this.mirrorConnectors)}makeBaseCoordinates(e,t){return t[0]}onElement(e,t){}makeGraphics(e,t,r){this.outputValueReader=r.getAddressValueReader(this.element.getOutputValueAddressProvider(0)());let i=e/this.makeDefaultHeight();return a.makeGraphics(this.height,this.width,void 0,i*a.DEFAULT_HEIGHT)}doRedraw(e){let t=this.outputValueReader();a.redraw(this.graphics,this.width,this.height,this.lineWidth,t?n.GraphicalWire.HIGH_COLOR:n.GraphicalWire.LOW_COLOR)}}t.GraphicalOr=a,function(e){e.DEFAULT_HEIGHT=36,e.DEFAULT_ELEMENT_SPACE=4,e.TEXT_COLOR=0}(a=t.GraphicalOr||(t.GraphicalOr={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(36),s=r(0),n=r(7),a=r(9),o=r(34),l=r(32),u=r(12),h=r(29),p=r(11),c=r(28),d=r(27),m=r(10),f=r(26),_=r(25),$=r(1),g=r(24),E=r(23),O=r(22),A=r(21),w=r(20),b=r(19),G=r(18),y=r(16),C=r(14),D=r(13);class T{static parse(e,t=!1,r=[]){let n=new Array(e.length),a=new Array(e.length);for(let t=0;t<e.length;t++){let r=e[t],s=new i.Parser(i.Grammar.fromCompiled(D));s.feed(r),s.finish();let o=s.results[0];n[t]=o.elements,a[t]=o.config}let o={config:[].concat(...a),elements:[].concat(...n)};if(!o.elements.length)throw new Error("nothing parsed");let l=o.elements,u=this.parseParameters(void 0,void 0,o.config,{height:{default:T.DEFAULT_TOTAL_HEIGHT},autoSource:{default:!1},autoSourceDeltaX:{default:-2*s.GraphicalWire.DEFAULT_ELEMENT_DISTANCE},autoSourceDeltaY:{default:0},stepsPerSecond:{default:0},cyclesPerStep:{default:0},delayPerWindowHeight:{default:-1},echoData:{default:!1},echoFunctions:{default:!1},disableGraphics:{default:!1}}),h={},p={},c=[],d=[];for(let e of r){if(h[e])throw new Error("duplicate known element "+e);h[e]={element:void 0,inputs:{},outputs:{}}}for(let e of l){if(h[e.name])throw new Error("duplicate element "+e.name);h[e.name]={element:e,inputs:{},outputs:{}}}for(let e of l){let r=e.name,i=h[r];if(i.element){for(let e of i.element.outsideInputs){let t=null!==e.inputIndex?e.inputIndex:T.getNextFreeIndex(i.inputs);for(let s=0;s<=e.more;s++){if(i.inputs[t+s])throw new Error(`cannot set input ${t} of element ${r} as outside input: input is already occupied`);if(u.autoSource){let e=T.makeAutoSource(r,t+s,u.autoSourceDeltaX,u.autoSourceDeltaY);if(h[e.name])throw new Error(`cannot create autosource element for element ${r}: element ${e.name} exists`);l.push(e),h[e.name]={element:e,inputs:{},outputs:{}},i.inputs[t+s]={name:e.name,outputIndex:0}}else i.inputs[t+s]={name:"outside",outputIndex:e.outputIndex+s}}}for(let e of i.element.externalOutputs)for(let t=0;t<=e.more;t++){let r=e.outputIndex+t;if(i.outputs[r])throw new Error(i.element.name+": cannot use output index "+r+" for external output twice");i.outputs[r]=!0}for(let e=0;e<i.element.wires.length;e++){let n=i.element.wires[e],a=null!==n.outputIndex?n.outputIndex:T.getNextFreeIndex(i.outputs);for(let t=0;t<=n.more;t++)if(i.outputs[a+t])throw new Error(i.element.name+", wire index "+e+": cannot use output index "+(a+t)+" twice");for(let e=0;e<=n.more;e++)i.outputs[a+e]=!0;let o=n.coordinates[n.coordinates.length-1];if(!o.name||"input"!==o.connector||void 0===o.index)throw new Error(i.element.name+", wire index "+e+": wire needs to terminate in some input connector of some element");let l=o.name,u=h[l];if(!u)throw new Error(i.element.name+", wire index "+e+": unknown element name in terminating input connector reference: "+o.name);let d=null!==o.index?o.index:T.getNextFreeIndex(u.inputs);for(let t=0;t<=n.more;t++)if(u.inputs[d+t]&&u.inputs[d+t].name!==i.element.name)throw new Error(i.element.name+", wire index "+e+": target element input index "+(d+t)+" is occupied");let m=a+Math.floor(n.more/2),f={name:o.name,connector:o.connector,index:d+Math.floor(n.more/2)},_=r+"_o"+a+"_"+l+"_i"+d+"_wire";if(h[_]||p[_])throw new Error(i.element.name+", wire index "+e+": cannot assign wire name "+_+" because it is already used");p[_]=!0;let $=null!==n.initialValue?n.initialValue:void 0,g=new s.GraphicalWire(_,$,1+n.more),E=[];for(let e=0;e<=n.more;e++)E.push({name:r,outputIndex:a+e});c.push({name:_,element:t?"GraphicalWire":g,height:"auto",inputs:E,externalOutputs:[],coordinates:[{name:r,connector:"output",index:m},...n.coordinates.slice(0,n.coordinates.length-1),f]});for(let e=0;e<=n.more;e++)u.inputs[d+e]={name:_,outputIndex:e}}}}for(let e of l){let r=e.name,i=h[r];if(!i.element)continue;let s=0;for(let e in i.inputs)s++;let n=new Array(s);for(let e=0;e<n.length;e++){if(!i.inputs[e])throw new Error("element "+r+": input index "+e+" is not connected");n[e]=i.inputs[e]}let a=0;for(let e of i.element.wires)a++,a+=e.more;let o=0;for(let e of i.element.externalOutputs)o++,o+=e.more;let l=new Array(o),u=0;for(let e of i.element.externalOutputs)for(let t=0;t<=e.more;t++)l[u]=e.outputIndex+t,u++;let p=T.makeElement(i,n,a+o);d.push({name:r,element:t?p.constructor.name:p,height:"auto",inputs:n,externalOutputs:l,coordinates:[i.element.base]})}return{height:u.height,stepsPerSecond:u.stepsPerSecond>0?u.stepsPerSecond:void 0,cyclesPerStep:u.cyclesPerStep>0?u.cyclesPerStep:void 0,delayPerWindowHeight:u.delayPerWindowHeight<0?void 0:u.delayPerWindowHeight,echoData:u.echoData,echoFunctions:u.echoFunctions,disableGraphics:u.disableGraphics,wiringDescriptions:[...d,...c]}}static getNextFreeIndex(e){for(let t=0;;t++)if(void 0===e[t])return t}static makeAutoSource(e,t,r,i){return{name:`autosource_${e}_input${t}`,type:"source",parameters:[],base:{base:{connector:"output",index:0},coordinates:{x:{delta:r,from:{name:e,connector:"input",index:t}},y:{delta:i,from:{name:e,connector:"input",index:t}}}},outsideInputs:[],externalOutputs:[],wires:[{outputIndex:0,more:0,coordinates:[{name:e,connector:"input",index:t}],initialValue:null}]}}static parseParameters(e,t,r,i){let s=e?`element ${e}`:"root",n=t?`type ${t}`:"config",a={};for(let e of r){let t,r=i[e.key];if(!r)throw new Error(`${s}: unknown parameter for ${n}: ${e.key}`);if(r.parse)try{t=r.parse(e.value)}catch(t){throw new Error(`${s}: parsing of parameter ${e.key} failed for ${n}: `+t.name+": "+t.message+"\n"+t.stack)}else if("number"==typeof r.default){if(t=parseInt(e.value),isNaN(t))throw new Error(`${s}: parsing of parameter ${e.key} failed for ${n}: number expected, got: ${e.value}`)}else if("boolean"==typeof r.default){if("true"!==e.value&&"false"!==e.value)throw new Error(`${s}: parsing of parameter ${e.key} failed for ${n}: boolean expected, got: ${e.value}`);t="true"===e.value}else t=e.value;a[e.key]=t}for(let e in i)if(!a.hasOwnProperty(e)){let t=i[e];if(t.required)throw new Error(`${s}: missing parameter ${e} for ${n}`);a[e]=t.default}for(let t in a){let r=i[t];if(r.check){let i=a[t];if(!r.check(i))throw new Error(`element ${e}: parsing of parameter ${t} failed for ${n}: check function returned false for value ${i}: ${r.check.toString()}`)}}return a}static makeElement(e,t,r){let i=e.element,s=i.type;switch(s){case"nor":{let e=T.parseParameters(i.name,s,i.parameters,T.PARAMS_INIT_OVERRIDEHEIGHT_MIRRORCONNECTORS);return new n.GraphicalNor(i.name,t.length,e.init,e.overrideHeight>=0?e.overrideHeight:void 0,e.mirrorConnectors)}case"or":{let e=T.parseParameters(i.name,s,i.parameters,T.PARAMS_DETAILED_OVERRIDEHEIGHT_MIRRORCONNECTORS);return new $.GraphicalOr(i.name,t.length,e.detailed,e.overrideHeight>=0?e.overrideHeight:void 0,e.mirrorConnectors)}case"and":{let e=T.parseParameters(i.name,s,i.parameters,T.PARAMS_DETAILED_OVERRIDEHEIGHT);return new g.GraphicalAnd(i.name,t.length,e.detailed,e.overrideHeight>=0?e.overrideHeight:void 0)}case"xor":{let e=T.parseParameters(i.name,s,i.parameters,T.PARAMS_DETAILED_OVERRIDEHEIGHT);return new E.GraphicalXor(i.name,e.detailed,e.overrideHeight>=0?e.overrideHeight:void 0)}case"sink":T.parseParameters(i.name,s,i.parameters,{});return new o.GraphicalSinkTerminal(i.name);case"source":T.parseParameters(i.name,s,i.parameters,{});return new l.GraphicalSourceTerminal(i.name,!1);case"split":{let e=T.parseParameters(i.name,s,i.parameters,Object.assign({},T.PARAMS_INIT_OVERRIDEHEIGHT,{numInBits:{default:t.length,check:e=>e>=0},numOutChannels:{default:r/Math.max(t.length,1)},line:{default:!1},displayValue:{default:"",check:e=>""===e||"aboveLeft"===e||"aboveRight"===e||"belowLeft"===e||"belowRight"===e}}));return new u.GraphicalSplit(i.name,e.numOutChannels,e.numInBits,e.line,e.overrideHeight>=0?e.overrideHeight:void 0,e.init,e.displayValue?e.displayValue:void 0)}case"decoder":{let e=T.parseParameters(i.name,s,i.parameters,Object.assign({},T.PARAMS_DETAILED_OVERRIDEHEIGHT_MIRRORCONNECTORS,{numInBits:{default:Math.max(t.length,Math.ceil(Math.log2(r))),check:e=>e>0}}));return new h.GraphicalDecoder(i.name,e.numInBits,e.detailed,e.mirrorConnectors,e.overrideHeight>=0?e.overrideHeight:void 0)}case"rsff":{let e=T.parseParameters(i.name,s,i.parameters,T.PARAMS_INIT);return new d.GraphicalRSFlipFlop(i.name,e.init)}case"dff":{let e=T.parseParameters(i.name,s,i.parameters,T.PARAMS_DETAILED_INIT);return new p.GraphicalDFlipFlop(i.name,e.detailed,e.init)}case"reg":{let e=T.parseParameters(i.name,s,i.parameters,Object.assign({},T.PARAMS_DETAILED_OVERRIDEHEIGHT,{numInBits:{default:Math.max(r,t.length-1),check:e=>e>=0},mirrorConnectors:{default:!1},readOnly:{default:!1},initHex:{default:""}}));return new c.GraphicalRegister(i.name,e.numInBits,e.detailed,e.overrideHeight>=0?e.overrideHeight:void 0,e.mirrorConnectors,e.readOnly,e.initHex.length?e.initHex:void 0)}case"mux":{let e=T.parseParameters(i.name,s,i.parameters,Object.assign({},T.PARAMS_DETAILED_OVERRIDEHEIGHT,{numInChannels:{default:Math.ceil(t.length/(r+1)),check:e=>e>0},numOutBits:{default:r,check:e=>e>0},wireDist:{default:-1},mirrorConnectors:{default:!1}}));return new m.GraphicalMultiplexer(i.name,e.numInChannels,e.numOutBits,e.detailed,e.wireDist>=0?e.wireDist:void 0,e.overrideHeight>=0?e.overrideHeight:void 0,e.mirrorConnectors)}case"ha":{let e=T.parseParameters(i.name,s,i.parameters,Object.assign({},T.PARAMS_DETAILED_OVERRIDEHEIGHT,{additionalAndOutput:{default:!1}}));return new f.GraphicalHalfAdder(i.name,e.detailed,e.overrideHeight>=0?e.overrideHeight:void 0,e.additionalAndOutput)}case"fa":{let e=T.parseParameters(i.name,s,i.parameters,Object.assign({},T.PARAMS_DETAILED_OVERRIDEHEIGHT,{additionalAndOutput:{default:!1}}));return new _.GraphicalFullAdder(i.name,e.detailed,e.overrideHeight>=0?e.overrideHeight:void 0,e.additionalAndOutput)}case"micro16":{let e=T.parseParameters(i.name,s,i.parameters,{code:{default:"",required:!0},instructionDelay:{default:-1},aluDelay:{default:-1},registersDelay:{default:-1}});return new O.GraphicalMicro16(i.name,e.code,e.instructionDelay>=0?e.instructionDelay:void 0,e.aluDelay>=0?e.aluDelay:void 0,e.registersDelay>=0?e.registersDelay:void 0)}case"micro16regs":T.parseParameters(i.name,s,i.parameters,{});return new A.GraphicalMicro16Registers(i.name);case"micro16alu":T.parseParameters(i.name,s,i.parameters,{});return new w.GraphicalMicro16Alu(i.name);case"micro16mic":T.parseParameters(i.name,s,i.parameters,{});return new b.GraphicalMicro16Mic(i.name);case"micro16store":{let e=T.parseParameters(i.name,s,i.parameters,{code:{default:"",required:!0}});return new G.GraphicalMicro16Store(i.name,e.code)}case"micro16clock":{let e=T.parseParameters(i.name,s,i.parameters,{instructionDelay:{default:-1},aluDelay:{default:-1},registersDelay:{default:-1}});return new y.GraphicalMicro16Clock(i.name,e.instructionDelay>=0?e.instructionDelay:void 0,e.aluDelay>=0?e.aluDelay:void 0,e.registersDelay>=0?e.registersDelay:void 0)}case"manynors":{let e=T.parseParameters(i.name,s,i.parameters,{n:{default:1,check:e=>e>0,required:!0}});return new C.GraphicalManyNors(i.name,e.n)}}throw new a.NeverError(s,"element "+i.name+": unknown type: "+i.type)}}t.GrammarParser=T,function(e){e.DEFAULT_TOTAL_HEIGHT=600,e.PARAMS_DETAILED={detailed:{default:!1}},e.PARAMS_INIT={init:{default:!1}},e.PARAMS_OVERRIDEHEIGHT={overrideHeight:{default:-1}},e.PARAMS_MIRRORCONNECTORS={mirrorConnectors:{default:!1}},e.PARAMS_DETAILED_INIT=Object.assign({},e.PARAMS_DETAILED,e.PARAMS_INIT),e.PARAMS_DETAILED_OVERRIDEHEIGHT=Object.assign({},e.PARAMS_DETAILED,e.PARAMS_OVERRIDEHEIGHT),e.PARAMS_DETAILED_OVERRIDEHEIGHT_MIRRORCONNECTORS=Object.assign({},e.PARAMS_DETAILED_OVERRIDEHEIGHT,e.PARAMS_MIRRORCONNECTORS),e.PARAMS_INIT_OVERRIDEHEIGHT=Object.assign({},e.PARAMS_INIT,e.PARAMS_OVERRIDEHEIGHT),e.PARAMS_INIT_OVERRIDEHEIGHT_MIRRORCONNECTORS=Object.assign({},e.PARAMS_INIT_OVERRIDEHEIGHT,e.PARAMS_MIRRORCONNECTORS)}(T=t.GrammarParser||(t.GrammarParser={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(4);t.CompactCombinedGraphicalElement=class{constructor(e,t,r){this.name=e,this.totalHeight=t,this.detailed=r}getName(){return this.name}prefixName(e){this.name=e+this.name}initConnectorCoordinates(e){let t=this.makeWiringDescriptions();this.combinedGraphicalElement=new i.CombinedGraphicalElement(this.name,this.totalHeight,t),this.combinedGraphicalElement.initConnectorCoordinates(e),this.compactConnectorCoordinates=this.makeConnectorCoordinates(e),this.connectorCoordinates=this.detailed?this.combinedGraphicalElement.connectorCoordinates:this.compactConnectorCoordinates}initBaseCoordinates(e,t){this.combinedGraphicalElement.initBaseCoordinates(e,t),this.compactBaseCoordinates=this.makeBaseCoordinates(e,t),this.baseCoordinates=this.detailed?this.combinedGraphicalElement.baseCoordinates:this.compactBaseCoordinates}initElement(e,t){this.combinedGraphicalElement.initElement(e,t),this.element=this.combinedGraphicalElement.element,this.onElement(e,t)}initGraphics(e,t,r){this.combinedGraphicalElement.initGraphics(e,t,r),this.compactGraphics=this.makeGraphics(e,t,r),this.graphics=this.detailed?this.combinedGraphicalElement.graphics:this.compactGraphics}redraw(e){this.detailed?this.combinedGraphicalElement.redraw(e):this.doRedraw(e)}getDefaultHeight(){return this.detailed?this.totalHeight:this.makeDefaultHeight()}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(5),s=r(37);t.CombinedGraphicalElement=class extends i.StubGraphicalElement{constructor(e,t,r){super(e),this.totalHeight=t,this.wiringDescriptions=r,this.elementInfosList=[],this.elementsList=[]}getDefaultHeight(){return this.totalHeight}scaleCoordinateValue(e,t){return e*t/this.totalHeight}resolveCoordinatesDescription(e,t,r,i,s,n,a){let o,l,u;o={x:0,y:0};let h=e.coordinates[r];if(h.base){let t=h,r=this.resolveOwnRelativeConnectorCoordinatesReference(t.base,e.element,e.name);o.x-=r.x,o.y-=r.y,h=t.coordinates}if(void 0!==h.x&&void 0!==h.y)l=this.resolveCoordinateValueDescription(h.x,e,r,o,"x",i,s,n,a),u=this.resolveCoordinateValueDescription(h.y,e,r,o,"y",i,s,n,a);else{let e=h,t=this.resolveConnectorCoordinatesReference(e,i);o.x+=t.x,o.y+=t.y,l=u=!0}t[r]=o,l&&this.updateSubscribersAndPrevValues(s,n,o,"x"),u&&this.updateSubscribersAndPrevValues(s,n,o,"y")}updateSubscribersAndPrevValues(e,t,r,i){let s=r[i];t[i]=s;let n=e[i];for(let e=n.length-1;e>=0;e--){let t=n[e];t.coordinates[t.coordinate]+=s,s=t.coordinates[t.coordinate]}e[i]=[]}resolveCoordinateValueDescription(e,t,r,i,s,n,a,o,l){if("number"==typeof e)return i[s]+=this.scaleCoordinateValue(e,l),!0;if("next"===e)return a[s].push({coordinates:i,coordinate:s}),!1;if("prev"===e){let e=o[s];if(void 0===e)throw new Error(this.getName()+": graphical element "+t.name+", coordinates index "+r+": no previous value yet for "+s);if(a[s].length)throw new Error(this.getName()+": graphical element "+t.name+", coordinates index "+r+": previous "+s+" value referenced, but previous value references next");return i[s]+=e,!0}if(void 0!==e.delta){let u=e;return i[s]+=this.scaleCoordinateValue(u.delta,l),this.resolveCoordinateValueDescription(u.from,t,r,i,s,n,a,o,l)}if(e.name)return i[s]+=this.resolveConnectorCoordinatesReference(e,n)[s],!0;throw new Error(this.getName()+": graphical element "+t.name+", coordinates index "+r+": unknown coordinate value description for "+s)}resolveConnectorCoordinatesReference(e,t){let r=t[e.name];if(!r)throw new Error(this.getName()+": no such wiring description name (yet; remember: no forward references): "+e.name);let i=this.resolveOwnRelativeConnectorCoordinatesReference(e,r,e.name);return{x:r.baseCoordinates.x+i.x,y:r.baseCoordinates.y+i.y}}resolveOwnRelativeConnectorCoordinatesReference(e,t,r){let i=t.connectorCoordinates;if(!i)throw new Error(this.getName()+": wiring description name "+r+" has no connector coordinates");let s=i[e.connector];if(e.index>=s.length)throw new Error(this.getName()+": wiring description name "+r+" has no connector coordinates index "+e.index+" at connector "+e.connector);return s[e.index]}resolveHeight(e){let t=e.height;return"auto"===t?e.element.getDefaultHeight():t}makeConnectorCoordinates(e){for(let t of this.wiringDescriptions)t.element.prefixName(this.getName()+"/"),t.element.initConnectorCoordinates(this.scaleCoordinateValue(this.resolveHeight(t),e));let t={};this.elementWiringDescriptions=new Array(this.wiringDescriptions.length);for(let r=0;r<this.wiringDescriptions.length;r++){let i=this.wiringDescriptions[r],s=new Array(i.coordinates.length),n={x:void 0,y:void 0},a={x:[],y:[]};for(let r=0;r<s.length;r++)this.resolveCoordinatesDescription(i,s,r,t,a,n,e);if(a.x.length)throw new Error(this.getName()+": graphical element "+i.name+": forward x value references left, but no more coordinates");if(a.y.length)throw new Error(this.getName()+": graphical element "+i.name+": forward y value references left, but no more coordinates");let o=this.scaleCoordinateValue(this.resolveHeight(i),e);i.element.initBaseCoordinates(o,s),i.element.initElement(o,s),t[i.name]=i.element,this.elementInfosList.push({wiringDescription:i,elementHeight:o,coordinates:s}),this.elementsList.push(i.element),this.elementWiringDescriptions[r]={name:i.name,element:i.element.element,inputs:i.inputs,externalOutputs:i.externalOutputs}}this.combinedElement=new s.CombinedElement(this.name,this.elementWiringDescriptions);let r={input:[],output:[]};for(let e of this.combinedElement.inputReceiverDescriptions){let i=t[e.wiringDescriptionName],s=i.connectorCoordinates;if(!s)throw new Error(this.getName()+": element "+i.getName()+" reads input, but does not provide connector coordinates");let n=s.input[e.index];if(!n)throw new Error(this.getName()+": element "+i.getName()+" reads input, but does not provide connector coordinates for input index "+e.index);r.input.push({x:i.baseCoordinates.x+n.x,y:i.baseCoordinates.y+n.y})}for(let e of this.combinedElement.outputSourceDescriptions){let i=t[e.wiringDescriptionName],s=i.connectorCoordinates;if(!s)throw new Error(this.getName()+": element "+i.getName()+" delivers output, but does not provide connector coordinates");let n=s.output[e.index];if(!n)throw new Error(this.getName()+": element "+i.getName()+" delivers output, but does not provide connector coordinates for output index "+e.index);r.output.push({x:i.baseCoordinates.x+n.x,y:i.baseCoordinates.y+n.y})}return r}makeBaseCoordinates(e,t){return t[0]}makeElement(e,t){return this.combinedElement}makeGraphics(e,t,r){let i=new PIXI.Graphics;for(let e=this.elementInfosList.length-1;e>=0;e--){let t=this.elementInfosList[e];t.wiringDescription.element.initGraphics(t.elementHeight,t.coordinates,r);let s=t.wiringDescription.element.graphics;if(!s)throw new Error(this.getName()+": element "+t.wiringDescription.name+" fails to provide graphics");s.x=t.wiringDescription.element.baseCoordinates.x,s.y=t.wiringDescription.element.baseCoordinates.y,i.addChild(s)}return i}redraw(e){for(let t of this.elementsList)t.redraw(e)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.StubGraphicalElement=class{constructor(e){this.name=e}getName(){return this.name}prefixName(e){this.name=e+this.name}initConnectorCoordinates(e){this.connectorCoordinates=this.makeConnectorCoordinates(e)}initBaseCoordinates(e,t){this.baseCoordinates=this.makeBaseCoordinates(e,t)}initElement(e,t){this.element=this.makeElement(e,t)}initGraphics(e,t,r){this.graphics=this.makeGraphics(e,t,r)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(9);!function(e){class t{constructor(){this.offset=0,this.size=0,this.next=void 0,this.addresses=[]}getNew(){if(this.next)throw new Error("next Space was already created");return this.next=new t}onAddress(e){this.addresses.push(e)}calculateSizeAndOffsetNext(){for(let e of this.addresses)switch(e.type){case"StaticAddress":this.size=Math.max(this.size,e.info.address+1),e.info.address+=this.offset;break;case"RotatingAddress":this.size=Math.max(this.size,e.info.address+e.info.mod),e.info.address+=this.offset;break;default:throw new i.NeverError(e,"unexpected address type")}this.next&&(this.next.offset=this.offset+this.size)}}e.Space=t;e.StaticAddress=class{constructor(e){this.info=e,this.type="StaticAddress",e.space.onAddress(this)}};e.RotatingAddress=class{constructor(e){this.info=e,this.type="RotatingAddress",e.space.onAddress(this)}dummy(){}}}(t.ConnectedElement||(t.ConnectedElement={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(35),s=r(5),n=r(1),a=r(0);class o extends s.StubGraphicalElement{constructor(e,t,r=!1,i=o.DEFAULT_HEIGHT,s=!1){super(e),this.numInputs=t,this.initialValue=r,this.defaultHeight=i,this.mirrorConnectors=s}getDefaultHeight(){return this.defaultHeight}makeConnectorCoordinates(e){let t=e/this.getDefaultHeight();return this.height=e,this.orWidth=n.GraphicalOr.getWidth(t*o.DEFAULT_HEIGHT),this.lineWidth=n.GraphicalOr.getLineWidth(t*o.DEFAULT_HEIGHT),this.notRadius=t*o.DEFAULT_HEIGHT/12,this.orX=this.mirrorConnectors?2*this.notRadius:0,this.notCenterX=(this.mirrorConnectors?0:this.orWidth)+this.notRadius,this.notCenterY=this.height/2,n.GraphicalOr.makeConnectorCoordinates(this.orWidth+2*this.notRadius,this.height,this.numInputs,1,this.mirrorConnectors)}makeBaseCoordinates(e,t){return t[0]}makeElement(e,t){return new i.Nor(this.getName(),this.numInputs,this.initialValue)}makeGraphics(e,t,r){this.outputValueReader=r.getAddressValueReader(this.element.getOutputValueAddressProvider(0)());let i=e/this.getDefaultHeight();return n.GraphicalOr.makeGraphics(this.height,this.orWidth,void 0,i*o.DEFAULT_HEIGHT,this.orX)}redraw(e){let t=this.outputValueReader();this.graphics.clear(),this.graphics.lineStyle(this.lineWidth,t?a.GraphicalWire.HIGH_COLOR:a.GraphicalWire.LOW_COLOR,1),this.graphics.drawRect(this.orX,0,this.orWidth,this.height),this.graphics.drawCircle(this.notCenterX,this.notCenterY,this.notRadius)}}t.GraphicalNor=o,function(e){e.DEFAULT_HEIGHT=n.GraphicalOr.DEFAULT_HEIGHT,e.DEFAULT_WIDTH=n.GraphicalOr.getWidth(e.DEFAULT_HEIGHT)+Math.floor(e.DEFAULT_HEIGHT/6)}(o=t.GraphicalNor||(t.GraphicalNor={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(6);t.LogicElement=class{constructor(e,t,r,i=!1){this.name=e,this.numInputs=t,this.numOutputs=r,this.initialValue=i,this.inputValueAddressProviders=new Array(t),this.generatedInputAddresses=new Array(t)}getName(){return this.name}getOwnType(){return"LogicElement/"+this.constructor.name}getDelay(){return 0}getChildren(){return[]}readInputFrom(e,t,r){if(!(e<this.inputValueAddressProviders.length))throw new Error(this.name+": input index "+e+" is out of bounds for this element");if(r>=t.getNumOutputs())throw new Error(this.name+": need output index "+r+", but "+t.getName()+" only has "+t.getNumOutputs()+" outputs");this.inputValueAddressProviders[e]=t.getOutputValueAddressProvider(r)}getNumOutputs(){return this.numOutputs}getOutputValueAddressProvider(e){if(e>=this.numOutputs)throw new Error(`${this.getName()}: output index ${e} is out of bounds for this element`);return()=>this.outputAddresses[e]}getWriteOutputsCalculations(e){this.inputSpace=e,e=e.getNew();let t=this.makeCalculations(this.inputSpace,e);if(t.outputAddresses.length!==this.numOutputs)throw new Error(`${this.getName()}: expected ${this.numOutputs} output addresses, but got ${t.outputAddresses.length}`);for(let r of t.outputAddresses)if(r.info.space!==e)throw new Error(`${this.getName()}: output addresses need to be in outputSpace`);return this.outputAddresses=t.outputAddresses,t.calculations}getReadInputsCalculations(){let e=[];for(let t=0;t<this.inputValueAddressProviders.length;t++){let r=this.inputValueAddressProviders[t];if(!r)throw new Error(this.getName()+": input "+t+" is not connected");let s=r(),n=new i.ConnectedElement.StaticAddress({address:t,space:this.inputSpace,hint:`automatically generated static input address of logic element ${this.getName()}`});this.generatedInputAddresses[t]=n,e.push({target:n,value:s})}return e}getUpdateFunctions(){let e=this.makeUpdateFunctions(),t=[];for(let r of e){let e=new Array(this.generatedInputAddresses.length),i=new Array(this.outputAddresses.length),s=this.generatedInputAddresses;r.reverseInputs&&(s=s.slice().reverse()),t.push({function:()=>r.function(e,i),interval:r.interval,inputAddresses:s,inputValues:e,outputAddresses:this.outputAddresses,outputValues:i})}return t}getInitiallyTrueAddresses(){return this.initialValue?this.outputAddresses:[]}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.NeverError=class extends Error{constructor(e,t){super(t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(2),s=r(1),n=r(3),a=r(0);class o extends n.CompactCombinedGraphicalElement{constructor(e,t,r,n=!1,l=a.GraphicalWire.DEFAULT_DISTANCE,u,h=!1){super(e,o.inputChannelBase(r,t,l)+r*l,n),this.numInChannels=t,this.numOutBits=r,this.wireDist=l,this.overrideHeight=u,this.mirrorConnectors=h;const p=a.GraphicalWire.DEFAULT_ELEMENT_DISTANCE;let c=[],d=o.outputBitBase(t,r,l);for(let e=0;e<t;e++){let i=o.inputChannelBase(r,e,l),n=i+r*l,u="",h=i+(r+1)*l;for(let m=0;m<r;m++){let f=i+(r-m-1)*l,_=e*(r+1)+m,$=`and_${e}_${m}`,g=o.outputBitBase(t,m,l)+2*p,E=`or_${m}`,O=p+e*l;if(c.push(`${$} and @${g}:${h} >n:p~n-${O}:n~${E}`),c.push(`input_split${e}_${m} split @0:${f} <${_} >n:p~n-${p}:n~${$}/i0`),m<=0){u=`enable_split${e} split @0:${n} <${(e+1)*(r+1)-1} >p:n~${$}/i1`}else m+1<r?(u+=` >enable_split${e}_${m}`,c.push(u),u=`enable_split${e}_${m} split @${$}/i1-${2*p}:${n} >p:n~${$}/i1`):(u+=` >n:p~n-${2*p}:n~${$}/i1`,c.push(u));if(e+1>=t){let e=`output_split${m}`,i=h+s.GraphicalOr.DEFAULT_HEIGHT+(r-m-1)*l;c.push(`${e} split @${d}:${i} 0>>`);let n=g+s.GraphicalOr.getWidth(s.GraphicalOr.DEFAULT_HEIGHT)+2*a.GraphicalWire.DEFAULT_ELEMENT_DISTANCE+(t-1)*l;c.push(`${E} or @${n}:${h} >p+${p}:p~p:n~${e}`)}}}this.wiringDescriptions=i.GrammarParser.parse(c).wiringDescriptions}static inputChannelBase(e,t,r){return t*((e+2)*r+s.GraphicalOr.DEFAULT_HEIGHT)}static outputBitBase(e,t,r){return t*(2*a.GraphicalWire.DEFAULT_ELEMENT_DISTANCE+s.GraphicalOr.getWidth(s.GraphicalOr.DEFAULT_HEIGHT)+2*a.GraphicalWire.DEFAULT_ELEMENT_DISTANCE+Math.max(0,e-1)*r+s.GraphicalOr.getWidth(s.GraphicalOr.DEFAULT_HEIGHT)+2*a.GraphicalWire.DEFAULT_ELEMENT_DISTANCE)}makeDefaultHeight(){return void 0!==this.overrideHeight?this.overrideHeight:(this.numInChannels*(this.numOutBits+1)+2)*this.wireDist}makeWiringDescriptions(){return this.wiringDescriptions}makeConnectorCoordinates(e){this.height=e;let t=e/this.makeDefaultHeight();return this.width=s.GraphicalOr.getWidth(t*s.GraphicalOr.DEFAULT_HEIGHT),this.lineWidth=s.GraphicalOr.getLineWidth(t*s.GraphicalOr.DEFAULT_HEIGHT),s.GraphicalOr.makeConnectorCoordinates(this.width,this.height,this.numInChannels*(this.numOutBits+1),this.numOutBits,this.mirrorConnectors)}makeBaseCoordinates(e,t){return t[0]}makeGraphics(e,t){let r=e/this.makeDefaultHeight();return s.GraphicalOr.makeGraphics(this.height,this.width,"MX",r*s.GraphicalOr.DEFAULT_HEIGHT)}onElement(e,t){}doRedraw(e){s.GraphicalOr.redraw(this.graphics,this.width,this.height,this.lineWidth,l.COMPACT_COLOR)}}var l;t.GraphicalMultiplexer=o,function(e){e.COMPACT_COLOR=0}(l=t.GraphicalDecoder||(t.GraphicalDecoder={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(3),s=r(7),n=r(1),a=r(0),o=r(2);class l extends i.CompactCombinedGraphicalElement{constructor(e,t=!1,r=!1){super(e,7*s.GraphicalNor.DEFAULT_HEIGHT,t),this.initialValue=r;const i=a.GraphicalWire.DEFAULT_ELEMENT_DISTANCE,n=s.GraphicalNor.DEFAULT_HEIGHT,l=s.GraphicalNor.DEFAULT_WIDTH,u=6*i+2*l,h=0+n,p=h+n,c=p+2*n,d=c+n,m=d+n;let f=[];f.push(`r_nor nor init=false @${u}:0 >p+${i}:p~p:n~r/i0=false`),f.push("d_split split @0:r_nor/i0 <0 >r_nor >p:n~d_nor"),f.push(`d_nor nor @d_split/o0+${i}:d_split/o0+${i} >p+${i}:p~p:n~s_nor/i0`),f.push(`s_nor nor init=false @r_nor/i0:${p} >p+${i}:p~p:n~s/i1=false`),f.push("e_nor nor init=true o0@d_nor/o0:s_nor/i1 <1 >e0_split=true"),f.push(`e0_split split @e_nor/o0+${i}:e_nor/o0 >e_split=true >p:${d}~n:${m}~n-${i}:n~e1_nor1=true`),f.push(`e1_nor0 nor @e_nor/i0:${c} >p+${2*i}:p~p:n~e1_nor=true`),f.push(`e1_nor1 nor @e_nor/i0:${m} >p+${i}:p~p:${m}~n:${d}~n-${i}:n~e1_nor0=false`),f.push(`e1_nor nor i0@e1_nor0/o0+${3*i}:e1_nor0/o0+${l} >n:p~e1_split=false`),f.push(`e1_split split @s_nor/i2-${i}:s_nor/i2 >s_nor/i2=false >p:n~r_nor/i2=false`),f.push(`e_split split @s_nor/i1-${2*i}:s_nor/i1 >s_nor=true >p:n~r_nor=true`),f.push(`r nor init=${r} @r_nor/o0+${3*i}:0 >r_split=${r}`),f.push(`s nor init=${!r} @r/i0:${p} >p+${i}:p~p:${p}~n:${h}~n-${i}:n~r/i1=${!r}`),f.push(`r_split split @r/o0+${i}:r/o0 0>> >p:${h}~n:${p}~n-${i}:n~s/i0=${r}`),this.wiringDescriptions=o.GrammarParser.parse(f).wiringDescriptions}makeDefaultHeight(){return l.DEFAULT_HEIGHT}makeWiringDescriptions(){return this.wiringDescriptions}makeConnectorCoordinates(e){return this.height=e,this.width=n.GraphicalOr.getWidth(this.height),this.lineWidth=n.GraphicalOr.getLineWidth(this.height),n.GraphicalOr.makeConnectorCoordinates(this.width,this.height,2,2)}makeBaseCoordinates(e,t){return t[0]}onElement(e,t){}makeGraphics(e,t,r){return this.outputValueReader=r.getAddressValueReader(this.element.getOutputValueAddressProvider(0)()),n.GraphicalOr.makeGraphics(this.height,this.width,"D")}doRedraw(e){let t=this.outputValueReader();this.graphics.clear(),this.graphics.lineStyle(this.lineWidth,t?a.GraphicalWire.HIGH_COLOR:a.GraphicalWire.LOW_COLOR,1),this.graphics.drawRect(0,0,this.width,this.height)}}t.GraphicalDFlipFlop=l,function(e){e.DEFAULT_HEIGHT=n.GraphicalOr.DEFAULT_HEIGHT}(l=t.GraphicalDFlipFlop||(t.GraphicalDFlipFlop={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(30),s=r(5),n=r(0),a=r(1);class o extends s.StubGraphicalElement{constructor(e,t,r,i=!1,s,l=!1,u){super(e),this.numOutChannels=t,this.numInBits=r,this.drawLine=i,this.initialValue=l,this.displayValue=u,this.valueReaders=new Array(Math.max(this.numInBits,1)),void 0===s&&(s=i?a.GraphicalOr.DEFAULT_HEIGHT:Math.ceil(o.DEFAULT_HEIGHT*n.GraphicalWire.getHeightMultiplicator(Math.max(this.numInBits,1)))),this.defaultHeight=s}getDefaultHeight(){return this.defaultHeight}makeConnectorCoordinates(e){if(this.drawLine)return a.GraphicalOr.makeConnectorCoordinates(0,e,this.numInBits,Math.max(this.numOutChannels,1)*Math.max(this.numInBits,1));{let e=[];for(let t=0;t<this.numInBits;t++)e.push({x:0,y:0});let t=[];for(let e=0;e<Math.max(this.numOutChannels,1)*Math.max(this.numInBits,1);e++)t.push({x:0,y:0});return{input:e,output:t}}}makeBaseCoordinates(e,t){return t[0]}makeElement(e,t){return new i.Split(this.getName(),this.numOutChannels,this.numInBits,this.initialValue)}makeGraphics(e,t,r){this.radius=e/2;let i=e/this.getDefaultHeight();this.lineWidth=i*n.GraphicalWire.DEFAULT_HEIGHT,this.lineHeight=e;for(let e=0;e<this.valueReaders.length;e++)this.valueReaders[e]=r.getAddressValueReader(this.element.getOutputValueAddressProvider(e)());let s=new PIXI.Graphics;if(this.displayValue){let e=Math.ceil(Math.max(this.numInBits,1)/4),t=new PIXI.Text("0".repeat(e),{fontSize:2*i*a.GraphicalOr.DEFAULT_HEIGHT/5,fontFamily:"Courier New",fill:a.GraphicalOr.TEXT_COLOR});t.anchor.set(this.displayValue.endsWith("Left")?1:0,this.displayValue.startsWith("above")?1:0),t.x=this.displayValue.endsWith("Left")?this.drawLine?0:-this.radius:this.drawLine?this.lineWidth:this.radius,t.y=this.displayValue.startsWith("above")?this.drawLine?0:-this.radius:this.drawLine?this.lineHeight:this.radius,s.addChild(t),this.text=t}return s}getOutputValueText(){const e=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];let t=new Array(Math.ceil(this.valueReaders.length/4)),r=0,i=0;for(let s=this.valueReaders.length-1;s>=0;s--)i<<=1,i|=this.valueReaders[s]()?1:0,s%4==0&&(t[r]=e[i],r++,i=0);return t.join("")}redraw(e){this.graphics.clear();let t=n.GraphicalWire.getLineColor(n.GraphicalWire.getDrawableOutputValueFromReaders(this.valueReaders));if(this.drawLine?(this.graphics.lineStyle(this.lineWidth,t,1),this.graphics.moveTo(0,0),this.graphics.lineTo(0,this.lineHeight)):(this.graphics.beginFill(t,1),this.graphics.drawCircle(0,0,this.radius)),this.text){let e=this.getOutputValueText();this.text.text!==e&&(this.text.text=e)}}}t.GraphicalSplit=o,function(e){e.DEFAULT_HEIGHT=5}(o=t.GraphicalSplit||(t.GraphicalSplit={}))},function(e,t){!function(){function t(e){return e[0]}var r={Lexer:void 0,ParserRules:[{name:"MAIN",symbols:["description"],postprocess:t},{name:"description$ebnf$1$subexpression$1",symbols:["config","whsp"]},{name:"description$ebnf$1",symbols:["description$ebnf$1$subexpression$1"],postprocess:t},{name:"description$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"description",symbols:["description$ebnf$1","elements"],postprocess:function(e){return{config:null!==e[0]?e[0][0]:[],elements:e[1]}}},{name:"config$ebnf$1$subexpression$1",symbols:["sep","config"]},{name:"config$ebnf$1",symbols:["config$ebnf$1$subexpression$1"],postprocess:t},{name:"config$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"config",symbols:["config_entry","config$ebnf$1"],postprocess:function(e){return[e[0]].concat(null!==e[1]?e[1][1]:[])}},{name:"config_entry",symbols:["name",{literal:"="},"minus_string"],postprocess:function(e){return{key:e[0],value:e[2]}}},{name:"elements$ebnf$1$subexpression$1",symbols:["whsp","elements"]},{name:"elements$ebnf$1",symbols:["elements$ebnf$1$subexpression$1"],postprocess:t},{name:"elements$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"elements",symbols:["element","elements$ebnf$1"],postprocess:function(e){return[e[0]].concat(e[1]?e[1][1]:[])}},{name:"sep",symbols:[{literal:" "}]},{name:"sep",symbols:[{literal:"\t"}]},{name:"sep",symbols:[{literal:"*"}]},{name:"sep",symbols:[{literal:"\n"}]},{name:"optsep",symbols:[]},{name:"optsep",symbols:["sep"]},{name:"whsp$string$1",symbols:[{literal:" "},{literal:" "}],postprocess:function(e){return e.join("")}},{name:"whsp",symbols:["whsp$string$1"]},{name:"whsp$string$2",symbols:[{literal:"*"},{literal:"*"}],postprocess:function(e){return e.join("")}},{name:"whsp",symbols:["whsp$string$2"]},{name:"whsp$string$3",symbols:[{literal:"\t"},{literal:"\t"}],postprocess:function(e){return e.join("")}},{name:"whsp",symbols:["whsp$string$3"]},{name:"whsp$string$4",symbols:[{literal:"\n"},{literal:"\n"}],postprocess:function(e){return e.join("")}},{name:"whsp",symbols:["whsp$string$4"]},{name:"element",symbols:["name","sep","type","params","sep","base","outside_inputs","outside_outputs","wires"],postprocess:function(e){return{name:e[0],type:e[2],parameters:e[3],base:e[5],outsideInputs:e[6],externalOutputs:e[7],wires:e[8]}}},{name:"name$ebnf$1",symbols:["string"],postprocess:t},{name:"name$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"name",symbols:[/[a-z]/,"name$ebnf$1"],postprocess:function(e){return e[0]+(e[1]||"")}},{name:"type",symbols:["name"],postprocess:t},{name:"string$ebnf$1",symbols:[/[a-zA-Z0-9_]/]},{name:"string$ebnf$1",symbols:["string$ebnf$1",/[a-zA-Z0-9_]/],postprocess:function(e){return e[0].concat([e[1]])}},{name:"string",symbols:["string$ebnf$1"],postprocess:function(e){return e[0].join("")}},{name:"minus_string$ebnf$1",symbols:[/[a-zA-Z0-9_-]/]},{name:"minus_string$ebnf$1",symbols:["minus_string$ebnf$1",/[a-zA-Z0-9_-]/],postprocess:function(e){return e[0].concat([e[1]])}},{name:"minus_string",symbols:["minus_string$ebnf$1"],postprocess:function(e){return e[0].join("")}},{name:"params$ebnf$1",symbols:[]},{name:"params$ebnf$1$subexpression$1",symbols:["sep","params_init"],postprocess:function(e){return e[1]}},{name:"params$ebnf$1",symbols:["params$ebnf$1","params$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"params",symbols:["params$ebnf$1"],postprocess:t},{name:"params_init",symbols:["name","optsep",{literal:"="},"optsep","string"],postprocess:function(e){return{key:e[0],value:e[4]}}},{name:"base$ebnf$1",symbols:["local_connector"],postprocess:t},{name:"base$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"base",symbols:["base$ebnf$1",{literal:"@"},"coordinates_remote"],postprocess:function(e){return e[0]?{base:e[0],coordinates:e[2]}:e[2]}},{name:"connector_type$subexpression$1",symbols:[{literal:"i"}]},{name:"connector_type$subexpression$1",symbols:[{literal:"o"}]},{name:"connector_type",symbols:["connector_type$subexpression$1"],postprocess:function(e){return"i"===e[0][0]?"input":"output"}},{name:"local_connector",symbols:["connector_type","uint"],postprocess:function(e){return{connector:e[0],index:e[1]}}},{name:"remote_connector",symbols:["name",{literal:"/"},"local_connector"],postprocess:function(e){return{name:e[0],connector:e[2].connector,index:e[2].index}}},{name:"coordinates_remote$subexpression$1",symbols:["coordinates_remote_separate"]},{name:"coordinates_remote$subexpression$1",symbols:["remote_connector"]},{name:"coordinates_remote",symbols:["coordinates_remote$subexpression$1"],postprocess:function(e){return e[0][0]}},{name:"coordinates_remote_separate$subexpression$1",symbols:["coordinate_remote",{literal:":"},"coordinate_remote"]},{name:"coordinates_remote_separate",symbols:["coordinates_remote_separate$subexpression$1"],postprocess:function(e){return{x:e[0][0],y:e[0][2]}}},{name:"coordinate_remote$subexpression$1",symbols:["coordinate"]},{name:"coordinate_remote$subexpression$1",symbols:["remote_connector"]},{name:"coordinate_remote$subexpression$1",symbols:["remote_connector_delta"]},{name:"coordinate_remote",symbols:["coordinate_remote$subexpression$1"],postprocess:function(e){return e[0][0]}},{name:"remote_connector_delta",symbols:["remote_connector","coordinate_delta"],postprocess:function(e){return{delta:e[1],from:e[0]}}},{name:"coordinates_reference$subexpression$1",symbols:["coordinates_reference_separate"]},{name:"coordinates_reference$subexpression$1",symbols:["remote_connector"]},{name:"coordinates_reference",symbols:["coordinates_reference$subexpression$1"],postprocess:function(e){return e[0][0]}},{name:"coordinates_reference_separate$subexpression$1",symbols:["coordinate_reference",{literal:":"},"coordinate_reference"]},{name:"coordinates_reference_separate",symbols:["coordinates_reference_separate$subexpression$1"],postprocess:function(e){return{x:e[0][0],y:e[0][2]}}},{name:"coordinate_reference$subexpression$1",symbols:["coordinate_remote"]},{name:"coordinate_reference$subexpression$1",symbols:["coordinate_reference_base"]},{name:"coordinate_reference$subexpression$1",symbols:["coordinate_reference_base_delta"]},{name:"coordinate_reference",symbols:["coordinate_reference$subexpression$1"],postprocess:function(e){return e[0][0]}},{name:"coordinate_reference_base_delta",symbols:["coordinate_reference_base","coordinate_delta"],postprocess:function(e){return{delta:e[1],from:e[0]}}},{name:"coordinate_reference_base$subexpression$1",symbols:[{literal:"p"}]},{name:"coordinate_reference_base$subexpression$1",symbols:[{literal:"n"}]},{name:"coordinate_reference_base",symbols:["coordinate_reference_base$subexpression$1"],postprocess:function(e){return"n"===e[0][0]?"next":"prev"}},{name:"coordinate_delta$subexpression$1",symbols:[{literal:"+"}]},{name:"coordinate_delta$subexpression$1",symbols:[{literal:"-"}]},{name:"coordinate_delta",symbols:["coordinate_delta$subexpression$1","uint"],postprocess:function(e){return"-"===e[0][0]?-1*e[1]:e[1]}},{name:"coordinate",symbols:["uint"],postprocess:t},{name:"outside_inputs$ebnf$1",symbols:[]},{name:"outside_inputs$ebnf$1$subexpression$1",symbols:["sep","outside_input_init"],postprocess:function(e){return e[1]}},{name:"outside_inputs$ebnf$1",symbols:["outside_inputs$ebnf$1","outside_inputs$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"outside_inputs",symbols:["outside_inputs$ebnf$1"],postprocess:t},{name:"outside_input_init$ebnf$1$subexpression$1",symbols:["uint","optsep"]},{name:"outside_input_init$ebnf$1",symbols:["outside_input_init$ebnf$1$subexpression$1"],postprocess:t},{name:"outside_input_init$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"outside_input_init$ebnf$2$subexpression$1",symbols:[{literal:"+"},"uint"]},{name:"outside_input_init$ebnf$2",symbols:["outside_input_init$ebnf$2$subexpression$1"],postprocess:t},{name:"outside_input_init$ebnf$2",symbols:[],postprocess:function(e){return null}},{name:"outside_input_init",symbols:["outside_input_init$ebnf$1",{literal:"<"},"optsep","uint","outside_input_init$ebnf$2"],postprocess:function(e){return{inputIndex:null!==e[0]?e[0][0]:null,outputIndex:e[3],more:null!==e[4]?e[4][1]:0}}},{name:"outside_outputs$ebnf$1",symbols:[]},{name:"outside_outputs$ebnf$1$subexpression$1",symbols:["sep","outside_output_init"],postprocess:function(e){return e[1]}},{name:"outside_outputs$ebnf$1",symbols:["outside_outputs$ebnf$1","outside_outputs$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"outside_outputs",symbols:["outside_outputs$ebnf$1"],postprocess:t},{name:"outside_output_init$ebnf$1$subexpression$1",symbols:[{literal:"+"},"uint"]},{name:"outside_output_init$ebnf$1",symbols:["outside_output_init$ebnf$1$subexpression$1"],postprocess:t},{name:"outside_output_init$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"outside_output_init$string$1",symbols:[{literal:">"},{literal:">"}],postprocess:function(e){return e.join("")}},{name:"outside_output_init",symbols:["uint","outside_output_init$ebnf$1","optsep","outside_output_init$string$1"],postprocess:function(e){return{outputIndex:e[0],more:null!==e[1]?e[1][1]:0}}},{name:"wires$ebnf$1",symbols:[]},{name:"wires$ebnf$1$subexpression$1",symbols:["sep","wire_init"],postprocess:function(e){return e[1]}},{name:"wires$ebnf$1",symbols:["wires$ebnf$1","wires$ebnf$1$subexpression$1"],postprocess:function(e){return e[0].concat([e[1]])}},{name:"wires",symbols:["wires$ebnf$1"],postprocess:t},{name:"wire_init$ebnf$1",symbols:["wire_output"],postprocess:t},{name:"wire_init$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"wire_init$ebnf$2$subexpression$1$subexpression$1$string$1",symbols:[{literal:"t"},{literal:"r"},{literal:"u"},{literal:"e"}],postprocess:function(e){return e.join("")}},{name:"wire_init$ebnf$2$subexpression$1$subexpression$1",symbols:["wire_init$ebnf$2$subexpression$1$subexpression$1$string$1"]},{name:"wire_init$ebnf$2$subexpression$1$subexpression$1$string$2",symbols:[{literal:"f"},{literal:"a"},{literal:"l"},{literal:"s"},{literal:"e"}],postprocess:function(e){return e.join("")}},{name:"wire_init$ebnf$2$subexpression$1$subexpression$1",symbols:["wire_init$ebnf$2$subexpression$1$subexpression$1$string$2"]},{name:"wire_init$ebnf$2$subexpression$1",symbols:[{literal:"="},"wire_init$ebnf$2$subexpression$1$subexpression$1"]},{name:"wire_init$ebnf$2",symbols:["wire_init$ebnf$2$subexpression$1"],postprocess:t},{name:"wire_init$ebnf$2",symbols:[],postprocess:function(e){return null}},{name:"wire_init",symbols:["wire_init$ebnf$1","wire","wire_init$ebnf$2"],postprocess:function(e){return{outputIndex:e[0]&&e[0].outputIndex,more:e[0]&&e[0].more,coordinates:e[1],initialValue:e[2]&&"true"===e[2][1][0]}}},{name:"wire_output$ebnf$1$subexpression$1$ebnf$1$subexpression$1",symbols:[{literal:"+"},"uint"]},{name:"wire_output$ebnf$1$subexpression$1$ebnf$1",symbols:["wire_output$ebnf$1$subexpression$1$ebnf$1$subexpression$1"],postprocess:t},{name:"wire_output$ebnf$1$subexpression$1$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"wire_output$ebnf$1$subexpression$1",symbols:["uint","wire_output$ebnf$1$subexpression$1$ebnf$1"]},{name:"wire_output$ebnf$1",symbols:["wire_output$ebnf$1$subexpression$1"],postprocess:t},{name:"wire_output$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"wire_output$subexpression$1",symbols:[{literal:">"}]},{name:"wire_output$subexpression$1",symbols:[{literal:"~"}]},{name:"wire_output",symbols:["wire_output$ebnf$1","wire_output$subexpression$1"],postprocess:function(e){return{outputIndex:e[0]&&e[0][0],more:e[0]&&null!==e[0][1]?e[0][1][1]:0}}},{name:"wire$subexpression$1",symbols:["wire_point"]},{name:"wire$subexpression$1",symbols:["wire_terminal"]},{name:"wire",symbols:["wire$subexpression$1"],postprocess:function(e){return e[0][0]}},{name:"wire_point$ebnf$1$subexpression$1",symbols:[{literal:"~"},"wire"]},{name:"wire_point$ebnf$1",symbols:["wire_point$ebnf$1$subexpression$1"],postprocess:t},{name:"wire_point$ebnf$1",symbols:[],postprocess:function(e){return null}},{name:"wire_point",symbols:["coordinates_reference","wire_point$ebnf$1"],postprocess:function(e){return[e[0]].concat(e[1]?e[1][1]:[])}},{name:"wire_terminal",symbols:["name"],postprocess:function(e){return[{name:e[0],connector:"input",index:null}]}},{name:"uint$ebnf$1",symbols:[/[0-9]/]},{name:"uint$ebnf$1",symbols:["uint$ebnf$1",/[0-9]/],postprocess:function(e){return e[0].concat([e[1]])}},{name:"uint",symbols:["uint$ebnf$1"],postprocess:function(e){return parseInt(e[0].join(""))}}],ParserStart:"MAIN"};void 0!==e&&void 0!==e.exports?e.exports=r:window.grammar=r}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(4),s=r(1),n=r(2),a=r(7);t.GraphicalManyNors=class extends i.CombinedGraphicalElement{constructor(e,t){let r=[];const i=s.GraphicalOr.DEFAULT_ELEMENT_SPACE;for(let e=0;e<t;e++)r.push(`nor${e} nor @${e>0?`nor${e-1}/o0+${i}`:"0"}:0${e<=0?" <0":""} ${e+1>=t?"0>>":`>nor${e+1}`}`);super(e,a.GraphicalNor.DEFAULT_HEIGHT,n.GrammarParser.parse(r).wiringDescriptions)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(8),s=r(6);t.Micro16Clock=class extends i.LogicElement{constructor(e,t=800,r=1400,i=400){super(e,0,3),this.delays=[t,r,i]}makeCalculations(e,t){let r={calculations:[],outputAddresses:[]},i=0;for(let e of this.delays)i+=e;let n=0;for(let e=0;e<this.delays.length;e++){let a=new s.ConnectedElement.StaticAddress({space:t,address:e,hint:`static output address for output ${e} of micro16 clock ${this.getName()}`});r.calculations.push({target:a,value:{type:"AlternatingValue",onDuration:this.delays[e],offDuration:i-this.delays[e],startOffset:i-n}}),n+=this.delays[e],r.outputAddresses.push(a)}return r}makeUpdateFunctions(){return[]}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(15),s=r(5),n=r(1),a=r(10);t.GraphicalMicro16Clock=class extends s.StubGraphicalElement{constructor(e,t,r,i){super(e),this.instructionDelay=t,this.aluDelay=r,this.registersDelay=i}getDefaultHeight(){return n.GraphicalOr.DEFAULT_HEIGHT}makeConnectorCoordinates(e){this.height=e;let t=e/this.getDefaultHeight();return this.width=n.GraphicalOr.getWidth(t*n.GraphicalOr.DEFAULT_HEIGHT),this.lineWidth=n.GraphicalOr.getLineWidth(t*n.GraphicalOr.DEFAULT_HEIGHT),n.GraphicalOr.makeConnectorCoordinates(this.width,this.height,0,3,!1)}makeBaseCoordinates(e,t){return t[0]}makeElement(e,t){return new i.Micro16Clock(this.getName(),this.instructionDelay,this.aluDelay,this.registersDelay)}makeGraphics(e,t){let r=e/this.getDefaultHeight();return n.GraphicalOr.makeGraphics(this.height,this.width,"CK",r*n.GraphicalOr.DEFAULT_HEIGHT)}redraw(e){n.GraphicalOr.redraw(this.graphics,this.width,this.height,this.lineWidth,a.GraphicalDecoder.COMPACT_COLOR)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(8),s=r(6);t.Micro16Store=class extends i.LogicElement{constructor(e,t){if(super(e,8,32),this.currentLineIndex=-1,t.length%8!=0)throw new Error(`${this.getName()}: code length is ${t.length}, but needs to be a multiple of 8`);this.lines=new Array(t.length/8);for(let e=0;e<this.lines.length;e++){let r=parseInt(t.substr(8*e,8),16),i=new Array(32);for(let e=31;e>=0;e--)i[e]=!!(1&r),r>>=1;this.lines[e]=i}}makeCalculations(e,t){let r=[];for(let e=0;e<32;e++){let i=new s.ConnectedElement.StaticAddress({space:t,address:e,hint:`static output address for output ${e} of micro16 store ${this.getName()}`});r.push(i)}return{calculations:[],outputAddresses:r}}makeUpdateFunctions(){return[{function:(e,t)=>{let r=0;for(let t of e)r<<=1,r|=t?1:0;if(r===this.currentLineIndex)return!1;let i=r<this.lines.length?this.lines[r]:void 0;for(let e=0;e<t.length;e++)t[e]=!(!i||!i[e]);return this.currentLineIndex=r,!0},interval:1,reverseInputs:!0}]}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(17),s=r(5),n=r(1),a=r(10);t.GraphicalMicro16Store=class extends s.StubGraphicalElement{constructor(e,t){super(e),this.code=t}getDefaultHeight(){return 4*n.GraphicalOr.DEFAULT_HEIGHT}makeConnectorCoordinates(e){this.height=e;let t=e/this.getDefaultHeight();return this.width=n.GraphicalOr.getWidth(t*n.GraphicalOr.DEFAULT_HEIGHT),this.lineWidth=n.GraphicalOr.getLineWidth(t*n.GraphicalOr.DEFAULT_HEIGHT),n.GraphicalOr.makeConnectorCoordinates(this.width,this.height,8,32,!1)}makeBaseCoordinates(e,t){return t[0]}makeElement(e,t){return new i.Micro16Store(this.getName(),this.code)}makeGraphics(e,t){let r=e/this.getDefaultHeight();return n.GraphicalOr.makeGraphics(this.height,this.width,"St",r*n.GraphicalOr.DEFAULT_HEIGHT)}redraw(e){n.GraphicalOr.redraw(this.graphics,this.width,this.height,this.lineWidth,a.GraphicalDecoder.COMPACT_COLOR)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(4),s=r(0),n=r(2),a=r(1);t.GraphicalMicro16Mic=class extends i.CombinedGraphicalElement{constructor(e){let t=[];const r=s.GraphicalWire.DEFAULT_DISTANCE,i=a.GraphicalOr.DEFAULT_ELEMENT_SPACE,o=s.GraphicalWire.DEFAULT_BUS_DISTANCE,l=a.GraphicalOr.getWidth(a.GraphicalOr.DEFAULT_HEIGHT),u=3*r+l+3*r,h=a.GraphicalOr.DEFAULT_HEIGHT,p=h,c=h/2,d=0+8*u,m=d+4*o,f=m+l+o+3*r,_=f,$=0+o,g=$,E=g+h+i,O=E+(2*c+i)+i,A=g+h+4*r;let w=[];for(let e=0;e<8;e++){let i=0+e*u;e<1||t.push(`add${e} ha detailed=true overrideHeight=${c} @${i}:${E} 1>p+${2*r}:p~p:n~collector/i${e}`+(e<7?` 0>p+${1*r}:p~p:n~add${e+1}/i1`:"")),w.push(`>n:p~add${e}/i0`)}t.push("add0 split @0:add1/i1 >add1/i1 >p:n~nor0"),t.push(`nor0 nor overrideHeight=${c} i0@${0+1*r}:add1/o1 >p+${2*r}:p~p:n~collector/i0`),t.push(`reg reg mirrorConnectors=true @${m}:${g} 8<8 0+7>out_split`),t.push(`distributor split line=true @${d}:${$} ${w.join(" ")}`),t.push(`out_split split @distributor/i3+${2*o}:distributor/i3 0+7>> 8+7>distributor`),t.push(`collector split line=true @0:${O} 0+7>p-${o}:p~p:0~n:p~n+${o}:n~mux/i0`),t.push(`mux mux mirrorConnectors=true overrideHeight=${p} o3@${f}:reg/i3 9<0+7 0+7>reg`),t.push(`jump_not nor @${_}:${A} >p+${3*r}:p~p:n~mux/i8`),t.push(`jump_split split @jump_not/i0-${2*r}:jump_not/i0 <9 >jump_not >p:${A-2*r}~n:p~n+${2*r}:n~mux/i17`),super(e,O+h,n.GrammarParser.parse(t).wiringDescriptions)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(4),s=r(0),n=r(2),a=r(1);t.GraphicalMicro16Alu=class extends i.CombinedGraphicalElement{constructor(e){let t=[];const r=s.GraphicalWire.DEFAULT_DISTANCE,i=(s.GraphicalWire.DEFAULT_BUS_DISTANCE,a.GraphicalOr.DEFAULT_ELEMENT_SPACE),o=Math.floor(a.GraphicalOr.DEFAULT_HEIGHT/2),l=17*r,u=2*l,h=o,p=a.GraphicalOr.DEFAULT_HEIGHT,c=2*(2*o+a.GraphicalOr.DEFAULT_ELEMENT_SPACE)+o+4*a.GraphicalOr.DEFAULT_ELEMENT_SPACE+s.GraphicalWire.DEFAULT_DISTANCE,d=69*r,m=o,f=l,_=p,$=a.GraphicalOr.getWidth(a.GraphicalOr.DEFAULT_HEIGHT),g=a.GraphicalOr.getWidth(a.GraphicalOr.DEFAULT_HEIGHT),E=3*s.GraphicalWire.DEFAULT_DISTANCE+a.GraphicalOr.getWidth(a.GraphicalOr.DEFAULT_HEIGHT)+3*s.GraphicalWire.DEFAULT_DISTANCE,O=E+a.GraphicalOr.DEFAULT_ELEMENT_SPACE,A=5*r+a.GraphicalOr.getWidth(a.GraphicalOr.DEFAULT_HEIGHT)+5*r,w=a.GraphicalOr.getWidth(_),b=2*g,G=18*r,y=G,C=G+$,D=C+2*a.GraphicalOr.DEFAULT_ELEMENT_SPACE+19*r+a.GraphicalOr.DEFAULT_ELEMENT_SPACE,T=D+16*E+16*a.GraphicalOr.DEFAULT_ELEMENT_SPACE+4*r,I=T+b,H=T,x=G,v=H,L=0+d+a.GraphicalOr.DEFAULT_ELEMENT_SPACE,R=0+l+a.GraphicalOr.DEFAULT_ELEMENT_SPACE+16*r+a.GraphicalOr.DEFAULT_ELEMENT_SPACE,S=R+h+a.GraphicalOr.DEFAULT_ELEMENT_SPACE,P=S+l+p,N=P+c+a.GraphicalOr.DEFAULT_ELEMENT_SPACE,k=N+18*r,F=k+3*r,M=F+18*r,W=M+4*m+6*i,U=W+2*r+i,V=U;let B=[],j=[],X=[],Y=[],z=[];t.push(`out_split split line=true overrideHeight=${f} displayValue=belowRight @0:${U} 0+15>>`);for(let e=0;e<16;e++)z.push(`>n:p~mux_split${e}`);t.push(`mux mux overrideHeight=${d} mirrorConnectors=true @${G}:0 ${z.join(" ")}`),t.push(`zero_nor nor overrideHeight=${u} @${y}:${L} >${C+4*r}:p~p:${k}~n-${2*r}:p~n:p~n-${3*r}:n~logic_z_or/i1`);for(let e=0;e<16;e++){let i=` >p:${F+(15-e)*r}~n:p~shifter_split${e}`;e>=15&&(t.push(`negative_split split @zero_nor/i${e}-${(17-e)*r}:${L+u+2*r}${i} >${C+3*r}:p~p:n~logic_n_or/i0`),i=" >negative_split"),t.push(`mux_split${e} split @zero_nor/i${e}-${(17-e)*r}:zero_nor/i${e} >zero_nor/i${e}${i}`)}t.push(`logic_n_or or i0@${H}:${k+r} <38 >p+${3*r}:p~p:n~logic_and/i1`),t.push(`logic_z_or or i0@${H}:logic_n_or/i0-${_+i} <37 >p+${2*r}:p~p:n~logic_and/i0`),t.push(`logic_and and o0@logic_z_or/o0+${w+5*r}:logic_z_or/o0 0>>`);for(let e=0;e<16;e++){let i=D+e*O;t.push(`not${e} nor overrideHeight=${h} @${i+2*r}:${R} >p+${2*r}:p~p:n~mux/i${e+17}`);let s=e>=15?"":e>0?` 0>p+${3*r}:p~p:n~add${e+1}/i2`:` 0>p:n~add${e+1}/i2`;t.push(`add${e} ${e>0?"fa":"ha"} detailed=true overrideHeight=${o} additionalAndOutput=true @${i}:${P}${s}\n1>p:n~mux/i${e+51}\n2>p+${2*r}:p~p:${N+(e+1)*r}~${C+(21-e)*r}:p~p:n~mux/i${e+34}`),t.push(`a_split${e} split @add${e}/i1:mux/i${e} >not_split${e} >mux/i${e}`),t.push(`not_split${e} split @a_split${e}/i0:not${e}/i0 >add${e}/i1 >not${e}`),B.push(`>areg_display_split/i${e}`),j.push(`>breg_display_split/i${e}`),X.push(`>a_split${e}`),Y.push(`>n:p~add${e}/i0`)}t.push(`areg reg overrideHeight=${l} mirrorConnectors=true @${I}:0 <0+15 ${B.join(" ")}`),t.push(`breg reg overrideHeight=${l} mirrorConnectors=true @${I}:${S} <16+15 ${j.join(" ")}`),t.push(`areg_display_split split line=true overrideHeight=${l} displayValue=belowRight i7@${T}:areg/o7 ${X.join(" ")}`),t.push(`breg_display_split split line=true overrideHeight=${l} displayValue=aboveRight i7@${T}:breg/o7 ${Y.join(" ")}`),t.push(`regs_enable_split split @areg/i16+${2*r}:areg/i16 <32 >areg/i16 >p:n~breg/i16`),t.push(`dec decoder mirrorConnectors=true o2@${H}:mux/i67 <33+1\n>p-${2*r}:p~p:n~mux/i16\n>p-${4*r}:p~${Math.floor(D+1.5*O)}:n~mux/i50\n>mux/i67\n>p-${3*r}:p~p:n~mux/i33`);for(let e=0;e<16;e++){let s=x+e*A+5*r,n=M,a=n+m+2*i,o=a+m+2*i,l=o+m+i,u=a-i,h=o-i;if(t.push(`shifter_forward_and${e} and overrideHeight=${m} @${s}:${n}`+(e<15?` >p+${4*r}:p~p:${u}~n:p~n+${3*r}:n~shifter_or${e+1}/i1`:"")),t.push(`shifter_backward_and${e} and overrideHeight=${m} @${s}:${a}`+(e>0?` >p+${2*r}:p~p:${h}~n:p~n+${4*r}:n~shifter_or${e-1}`:"")),t.push(`shifter_and${e} and overrideHeight=${m} @${s}:${o} >p+${2*r}:p~p:n~shifter_or${e}/i0`),t.push(`shifter_split${e} split @shifter_forward_and${e}/i0-${2*r}:shifter_forward_and${e}/i0 >shifter_forward_and${e} >shifter_backward_split${e}`),t.push(`shifter_backward_split${e} split @shifter_backward_and${e}/i0-${2*r}:shifter_backward_and${e}/i0 >shifter_backward_and${e} >p:n~shifter_and${e}`),t.push(`shifter_or${e} or mirrorConnectors=true overrideHeight=${m} @${s}:${l} >p-${5*r}:p~p:n~out_split`),e>0){let i=["forward_","backward_",""];for(let n=0;n<i.length;n++){let a=i[n],o=e>1?`${a}control_split${e-1}`:`n:p~n-${(4-n)*r}:n~shifter_${a}and${e-1}`;t.push(`${a}control_split${e} split @${s-(4-n)*r}:${W+n*r} >p:n~shifter_${a}and${e} >${o}`)}}}t.push(`shifter_nor nor mirrorConnectors=true @${v}:${V} >p-${2*r}:p~p:n~control_split15`),t.push(`shifter_nor_forward_split split @shifter_nor/i0+${3*r}:shifter_nor/i0 <35 >shifter_nor/i0 >p:n~forward_control_split15`),t.push(`shifter_nor_backward_split split @shifter_nor/i1+${2*r}:shifter_nor/i1 <36 >shifter_nor/i1 >p:n~backward_control_split15`),super(e,U+f,n.GrammarParser.parse(t).wiringDescriptions)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(4),s=r(0),n=r(2),a=r(1);t.GraphicalMicro16Registers=class extends i.CombinedGraphicalElement{constructor(e){const t=s.GraphicalWire.DEFAULT_DISTANCE,r=17*t,i=Math.floor(a.GraphicalOr.getWidth(a.GraphicalOr.DEFAULT_HEIGHT)),o=Math.floor(a.GraphicalOr.DEFAULT_HEIGHT/2),l=2*s.GraphicalWire.DEFAULT_HEIGHT,u=Math.floor(o/4),h=16*o+15*l,p=(Math.floor(a.GraphicalOr.getWidth(a.GraphicalOr.DEFAULT_HEIGHT)),18*t),c=p+10,d=c+i,m=d+2*i,f=c,_=f+2*i,$=c+i+2*i+170+18*t,g=r+a.GraphicalOr.DEFAULT_ELEMENT_SPACE+4*t,E=g+h+a.GraphicalOr.DEFAULT_ELEMENT_SPACE,O=$,A=E+r+a.GraphicalOr.DEFAULT_ELEMENT_SPACE,w=A+h;let b=[],G=[],y=[],C=[];b.push(`amux mux overrideHeight=${h} @${$}:${g} 0+15>>`),b.push(`bmux mux overrideHeight=${h} @${O}:${A} 0+15>>`);for(let e=0;e<16;e++){b.push(`reg_split${e} split @${m+10*(16-e)}:amux/i${17*e+7} 0+15>amux/i${17*e} 16+15>p:n~bmux/i${17*e}`);let r="";e<=2&&(r=` readOnly=true initHex=${["0000","0001","FFFF"][e]}`),b.push(`reg${e} reg overrideHeight=${o}${r} o7@${d}:reg_split${e}/i0 0+15>display_split${e}`),b.push(`display_split${e} split overrideHeight=${u} line=true displayValue=belowRight i7@reg${e}/o7+${2*t}:reg${e}/o7 0+15>reg_split${e}`),4===e?b.push(`s_split${e} split @${p}:reg${e}/i7 0+15>reg${e} 16+15>p:n~reg${e-1}`):e>4&&b.push(`s_split${e} split @${p}:reg${e}/i7`+(e<15?"":" <0+15")+` 0+15>reg${e} 16+15>s_split${e-1}`),e>2&&G.push(`${15-e}>p-${(e+2)*t+10}:p~p:n~reg${e}/i16`),y.push(`${15-e}>p-${(e+2)*t}:p~p:n~amux/i${17*(e+1)-1}`),C.push(`${15-e}>p-${(e+2)*t}:p~p:n~bmux/i${17*(e+1)-1}`)}b.push(`s_dec_mux mux numOutBits=16 numInChannels=1 mirrorConnectors=true overrideHeight=${r} @${f}:0 16<16 ${G.join(" ")}`),b.push(`s_dec decoder mirrorConnectors=true overrideHeight=${r} o7@${_}:s_dec_mux/i7 <17+3 0+15>s_dec_mux`),b.push(`a_dec decoder mirrorConnectors=true overrideHeight=${r} @${$}:0 <21+3 ${y.join(" ")}`),b.push(`b_dec decoder mirrorConnectors=true overrideHeight=${r} @${O}:${E} <25+3 ${C.join(" ")}`),super(e,w,n.GrammarParser.parse(b).wiringDescriptions)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(4),s=r(0),n=r(2),a=r(1);t.GraphicalMicro16=class extends i.CombinedGraphicalElement{constructor(e,t,r,i,o){let l=[];const u=s.GraphicalWire.DEFAULT_DISTANCE,h=a.GraphicalOr.getWidth(a.GraphicalOr.DEFAULT_HEIGHT),p=a.GraphicalOr.DEFAULT_HEIGHT,c=50+4*a.GraphicalOr.DEFAULT_HEIGHT+u;l.push(`regs micro16regs @0:60 0+15>p+${20+6*u}:p~p:250~n:p~n+10:n~alu/i0 16+15>p+10:p~p:240~n:p~n+20:n~alu/i16`),l.push(`alu micro16alu @450:260 0+15>p-10:p~p:p+50~n:p~regs/i0 16>p+${2*h+2*u}:p~p:${c+4*u}~n:p~mic/i9`),l.push(`mic micro16mic @450:100 0+7>p:${c+20}~n:p~n-10:n~store`);let d=`${void 0!==r?` instructionDelay=${r}`:""}${void 0!==i?` aluDelay=${i}`:""}${void 0!==o?` registersDelay=${o}`:""}`;l.push(`clock micro16clock${d} @1100:100\n>p+${6*u}:p~p:n~n:n+${2*u}~n-${2*u}:n~instruction_reg/i32\n>p+${4*u}:p~p:instruction_reg/i32+${4*u}~n:p~alu/o16+${2*h+0*u}:n~alu/i32\n>p+${2*u}:p~p:p+${p}~p-${h+4*u}:p~p:n~s_mic_enable_split`),l.push(`store micro16store code=${t} @1350:50 0+31>instruction_reg`),l.push(`instruction_reg reg overrideHeight=${4*a.GraphicalOr.DEFAULT_HEIGHT} i15@1390:store/o15\n1>n:p~alu/o16+${2*h+7*u}:n~n:n-${p}~n-${2*u}:n~alu/i37\n2>n:p~alu/o16+${2*h+8*u}:n~n:n+${p}~n-${2*u}:n~alu/i38\n3>n:p~alu/o16+${2*h+5*u}:n~alu/i34\n4>n:p~alu/o16+${2*h+4*u}:n~alu/i33\n5>n:p~alu/o16+${2*h+10*u}:n~alu/i35\n6>n:p~alu/o16+${2*h+11*u}:n~alu/i36\n12>p+${2*u}:p~p:n~n:regs/i17-${p+20+2*u}~n+${5*u}:n~regs/i20\n13>p+${3*u}:p~p:n~n:regs/i17-${p+20+3*u}~n+${4*u}:n~regs/i19\n14>p+${4*u}:p~p:n~n:regs/i17-${p+20+4*u}~n+${3*u}:n~regs/i18\n15>p+${5*u}:p~p:n~n:regs/i17-${p+20+5*u}~n+${2*u}:n~regs/i17\n16>p+${7*u}:p~p:n~n:regs/i21-${p+20-8*u}~n+${10*u}:n~regs/i28\n17>p+${8*u}:p~p:n~n:regs/i21-${p+20-7*u}~n+${9*u}:n~regs/i27\n18>p+${9*u}:p~p:n~n:regs/i21-${p+20-6*u}~n+${8*u}:n~regs/i26\n19>p+${10*u}:p~p:n~n:regs/i21-${p+20-5*u}~n+${7*u}:n~regs/i25\n20>p+${12*u}:p~p:n~n:regs/i21-${p+20-3*u}~n+${5*u}:n~regs/i24\n21>p+${13*u}:p~p:n~n:regs/i21-${p+20-2*u}~n+${4*u}:n~regs/i23\n22>p+${14*u}:p~p:n~n:regs/i21-${p+20-1*u}~n+${3*u}:n~regs/i22\n23>p+${15*u}:p~p:n~n:regs/i21-${p+20-0*u}~n+${2*u}:n~regs/i21\n24+7>p+10:p~p:${c+30}~n:p~n+${20+u}:n~mic/i0`),l.push(`s_mic_enable_split split @mic/i8+${2*u}:80 >p:n~mic/i8 >regs/i25+${12*u}:p~p:n~n:n+${3*u}~n+${2*u}:n~regs/i16`),super(e,600,n.GrammarParser.parse(l).wiringDescriptions)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(3),s=r(1),n=r(0),a=r(2);t.GraphicalXor=class extends i.CompactCombinedGraphicalElement{constructor(e,t=!1,r=s.GraphicalOr.DEFAULT_HEIGHT){super(e,2*s.GraphicalOr.DEFAULT_HEIGHT+3*n.GraphicalWire.DEFAULT_ELEMENT_DISTANCE,t),this.defaultHeight=r;let i=[];const o=n.GraphicalWire.DEFAULT_ELEMENT_DISTANCE,l=s.GraphicalOr.DEFAULT_HEIGHT+3*o;i.push(`a_split split @0:${l-2*o} <0 >p:n~a_nor >a_nb_nor/i1-${o}:p~p:n~a_nb_nor/i1`),i.push(`b_split split @${o}:${l-1*o} <1 >p:n~b_nor >na_b_nor/i0-${o}:p~p:n~na_b_nor/i0`),i.push(`b_nor nor @${2*o}:0 >p+${o}:p~p:n~a_nb_nor/i0`),i.push(`a_nor nor @${2*o}:${l} >p+${o}:p~p:n~na_b_nor/i1`),i.push(`a_nb_nor nor @b_nor/o0+${3*o}:0 >p+${2*o}:p~p:n~nor/i0`),i.push(`na_b_nor nor @a_nor/o0+${3*o}:${l} >p+${1*o}:p~p:n~nor/i1`),i.push(`nor nor @a_nb_nor/o0+${3*o}:${l} >not`),i.push(`not nor @nor/o0+${o}:${l} 0>>`),this.wiringDescriptions=a.GrammarParser.parse(i).wiringDescriptions}makeDefaultHeight(){return this.defaultHeight}makeWiringDescriptions(){return this.wiringDescriptions}makeConnectorCoordinates(e){this.height=e;let t=e/this.makeDefaultHeight();return this.width=s.GraphicalOr.getWidth(t*s.GraphicalOr.DEFAULT_HEIGHT),this.lineWidth=s.GraphicalOr.getLineWidth(t*s.GraphicalOr.DEFAULT_HEIGHT),s.GraphicalOr.makeConnectorCoordinates(this.width,this.height,2,1)}makeBaseCoordinates(e,t){return t[0]}onElement(e,t){}makeGraphics(e,t,r){this.outputValueReader=r.getAddressValueReader(this.element.getOutputValueAddressProvider(0)());let i=e/this.makeDefaultHeight();return s.GraphicalOr.makeGraphics(this.height,this.width,"=1",i*s.GraphicalOr.DEFAULT_HEIGHT)}doRedraw(e){let t=this.outputValueReader();s.GraphicalOr.redraw(this.graphics,this.width,this.height,this.lineWidth,t?n.GraphicalWire.HIGH_COLOR:n.GraphicalWire.LOW_COLOR)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(3),s=r(1),n=r(0),a=r(2);t.GraphicalAnd=class extends i.CompactCombinedGraphicalElement{constructor(e,t,r=!1,i=s.GraphicalOr.DEFAULT_HEIGHT,o=!1){super(e,t*(s.GraphicalOr.DEFAULT_HEIGHT+n.GraphicalWire.DEFAULT_ELEMENT_DISTANCE),r),this.numInputs=t,this.defaultHeight=i,this.initialValue=o;let l=[];const u=n.GraphicalWire.DEFAULT_ELEMENT_DISTANCE;for(let e=0;e<t;e++){let r=e*(s.GraphicalOr.DEFAULT_HEIGHT+n.GraphicalWire.DEFAULT_ELEMENT_DISTANCE),i=u+e*n.GraphicalWire.DEFAULT_DISTANCE;l.push(`in_nor${e} nor init=${!o} @0:${r} <${e} >n:p~n-${i}:n~out_nor=${!o}`),e+1>=t&&l.push(`out_nor nor init=${o} @in_nor${e}/o0+${i+u}:${r} 0>>`)}this.wiringDescriptions=a.GrammarParser.parse(l).wiringDescriptions}makeDefaultHeight(){return this.defaultHeight}makeWiringDescriptions(){return this.wiringDescriptions}makeConnectorCoordinates(e){this.height=e;let t=e/this.makeDefaultHeight();return this.width=s.GraphicalOr.getWidth(t*s.GraphicalOr.DEFAULT_HEIGHT),this.lineWidth=s.GraphicalOr.getLineWidth(t*s.GraphicalOr.DEFAULT_HEIGHT),s.GraphicalOr.makeConnectorCoordinates(this.width,this.height,this.numInputs)}makeBaseCoordinates(e,t){return t[0]}onElement(e,t){}makeGraphics(e,t,r){this.outputValueReader=r.getAddressValueReader(this.element.getOutputValueAddressProvider(0)());let i=e/this.makeDefaultHeight();return s.GraphicalOr.makeGraphics(this.height,this.width,"&",i*s.GraphicalOr.DEFAULT_HEIGHT)}doRedraw(e){let t=this.outputValueReader();s.GraphicalOr.redraw(this.graphics,this.width,this.height,this.lineWidth,t?n.GraphicalWire.HIGH_COLOR:n.GraphicalWire.LOW_COLOR)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(0),s=r(2),n=r(3),a=r(1);var o;t.GraphicalFullAdder=class extends n.CompactCombinedGraphicalElement{constructor(e,t=!1,r=a.GraphicalOr.DEFAULT_HEIGHT,n=!1){super(e,2*(2*r+a.GraphicalOr.DEFAULT_ELEMENT_SPACE)+r+4*a.GraphicalOr.DEFAULT_ELEMENT_SPACE+i.GraphicalWire.DEFAULT_DISTANCE,t),this.defaultElementHeight=r;let o=[];const l=i.GraphicalWire.DEFAULT_DISTANCE,u=3*l,h=2*r+a.GraphicalOr.DEFAULT_ELEMENT_SPACE+2*a.GraphicalOr.DEFAULT_ELEMENT_SPACE+i.GraphicalWire.DEFAULT_DISTANCE,p=h+r+2*a.GraphicalOr.DEFAULT_ELEMENT_SPACE,c=h-a.GraphicalOr.DEFAULT_ELEMENT_SPACE-i.GraphicalWire.DEFAULT_DISTANCE,d=p-a.GraphicalOr.DEFAULT_ELEMENT_SPACE;o.push(`or or overrideHeight=${r} @${u}:${h} 0>>`),o.push(`upper_ha ha detailed=true overrideHeight=${r}${n?" additionalAndOutput=true":""} @0:0 <0+1\n${n?"1>> 0>":`0>p+${3*l}:p~`}p:${c+l}~${u-2*l}:p~p:n~or/i0\n>p+${2*l}:p~p:${c}~${u-3*l}:p~p:n~lower_ha/i0`),o.push(`lower_ha ha detailed=true overrideHeight=${r} @0:${p} 1<2 1>> >p+${2*l}:p~p:${d}~${u-2*l}:p~p:n~or/i1`),this.wiringDescriptions=s.GrammarParser.parse(o).wiringDescriptions}makeDefaultHeight(){return this.defaultElementHeight}makeWiringDescriptions(){return this.wiringDescriptions}makeConnectorCoordinates(e){this.height=e;let t=e/this.makeDefaultHeight();return this.width=a.GraphicalOr.getWidth(t*a.GraphicalOr.DEFAULT_HEIGHT),this.lineWidth=a.GraphicalOr.getLineWidth(t*a.GraphicalOr.DEFAULT_HEIGHT),a.GraphicalOr.makeConnectorCoordinates(this.width,this.height,3,2)}makeBaseCoordinates(e,t){return t[0]}makeGraphics(e,t){let r=e/this.makeDefaultHeight();return a.GraphicalOr.makeGraphics(this.height,this.width,"FA",r*a.GraphicalOr.DEFAULT_HEIGHT)}onElement(e,t){}doRedraw(e){a.GraphicalOr.redraw(this.graphics,this.width,this.height,this.lineWidth,o.COMPACT_COLOR)}},function(e){e.COMPACT_COLOR=0}(o=t.GraphicalDecoder||(t.GraphicalDecoder={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(0),s=r(2),n=r(3),a=r(1);var o;t.GraphicalHalfAdder=class extends n.CompactCombinedGraphicalElement{constructor(e,t=!1,r=a.GraphicalOr.DEFAULT_HEIGHT,n=!1){super(e,2*r+a.GraphicalOr.DEFAULT_ELEMENT_SPACE,t),this.defaultElementHeight=r;let o=[];const l=i.GraphicalWire.DEFAULT_DISTANCE,u=3*l,h=r+a.GraphicalOr.DEFAULT_ELEMENT_SPACE;o.push(`and and overrideHeight=${r} @${u}:0 ${n?">and_split":"0>>"}`),n&&o.push(`and_split split @and/o0+${3*l}:and/o0 0>> 1>>`),o.push(`xor xor overrideHeight=${r} @${u}:${h} 0>>`),o.push(`a_split split @${l}:and/i0 <0 >and >p:n~xor`),o.push("b_split split @0:and/i1 <1 >and >p:n~xor"),this.wiringDescriptions=s.GrammarParser.parse(o).wiringDescriptions}makeDefaultHeight(){return this.defaultElementHeight}makeWiringDescriptions(){return this.wiringDescriptions}makeConnectorCoordinates(e){this.height=e;let t=e/this.makeDefaultHeight();return this.width=a.GraphicalOr.getWidth(t*a.GraphicalOr.DEFAULT_HEIGHT),this.lineWidth=a.GraphicalOr.getLineWidth(t*a.GraphicalOr.DEFAULT_HEIGHT),a.GraphicalOr.makeConnectorCoordinates(this.width,this.height,2,2)}makeBaseCoordinates(e,t){return t[0]}makeGraphics(e,t){let r=e/this.makeDefaultHeight();return a.GraphicalOr.makeGraphics(this.height,this.width,"HA",r*a.GraphicalOr.DEFAULT_HEIGHT)}onElement(e,t){}doRedraw(e){a.GraphicalOr.redraw(this.graphics,this.width,this.height,this.lineWidth,o.COMPACT_COLOR)}},function(e){e.COMPACT_COLOR=0}(o=t.GraphicalDecoder||(t.GraphicalDecoder={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(4),s=r(1),n=r(7),a=r(0),o=r(12);t.GraphicalRSFlipFlop=class extends i.CombinedGraphicalElement{constructor(e,t=!1){super(e,180,[{name:"R_nor",element:new n.GraphicalNor("R_nor",2,t),height:"auto",inputs:[{name:"outside",outputIndex:0},{name:"S_to_R_loop",outputIndex:0}],externalOutputs:[],coordinates:[{x:a.GraphicalWire.DEFAULT_ELEMENT_DISTANCE,y:0}]},{name:"R_out_split",element:new o.GraphicalSplit("R_out_split",2,1),height:"auto",inputs:[{name:"R_nor_out_wire",outputIndex:0}],externalOutputs:[1],coordinates:[{x:{delta:a.GraphicalWire.DEFAULT_ELEMENT_DISTANCE,from:{name:"R_nor",connector:"output",index:0}},y:{name:"R_nor",connector:"output",index:0}}]},{name:"S_nor",element:new n.GraphicalNor("S_nor",2,!t),height:"auto",inputs:[{name:"R_to_S_loop",outputIndex:0},{name:"outside",outputIndex:1}],externalOutputs:[],coordinates:[{x:a.GraphicalWire.DEFAULT_ELEMENT_DISTANCE,y:2*s.GraphicalOr.DEFAULT_HEIGHT}]},{name:"S_out_split",element:new o.GraphicalSplit("S_out_split",2,1),height:"auto",inputs:[{name:"S_nor_out_wire",outputIndex:0}],externalOutputs:[1],coordinates:[{x:{delta:a.GraphicalWire.DEFAULT_ELEMENT_DISTANCE,from:{name:"S_nor",connector:"output",index:0}},y:{name:"S_nor",connector:"output",index:0}}]},{name:"R_nor_out_wire",element:new a.GraphicalWire("R_nor_out_wire",t),height:"auto",inputs:[{name:"R_nor",outputIndex:0}],externalOutputs:[],coordinates:[{name:"R_nor",connector:"output",index:0},{name:"R_out_split",connector:"input",index:0}]},{name:"S_nor_out_wire",element:new a.GraphicalWire("S_nor_out_wire0",!t),height:"auto",inputs:[{name:"S_nor",outputIndex:0}],externalOutputs:[],coordinates:[{name:"S_nor",connector:"output",index:0},{name:"S_out_split",connector:"input",index:0}]},{name:"R_to_S_loop",element:new a.GraphicalWire("R_to_S_loop",t),height:"auto",inputs:[{name:"R_out_split",outputIndex:0}],externalOutputs:[],coordinates:[{name:"R_out_split",connector:"output",index:0},{x:"prev",y:s.GraphicalOr.DEFAULT_HEIGHT},{x:"next",y:2*s.GraphicalOr.DEFAULT_HEIGHT},{x:0,y:"next"},{name:"S_nor",connector:"input",index:0}]},{name:"S_to_R_loop",element:new a.GraphicalWire("S_to_R_loop",!t),height:"auto",inputs:[{name:"S_out_split",outputIndex:0}],externalOutputs:[],coordinates:[{name:"S_out_split",connector:"output",index:0},{x:"prev",y:2*s.GraphicalOr.DEFAULT_HEIGHT},{x:"next",y:s.GraphicalOr.DEFAULT_HEIGHT},{x:0,y:"next"},{name:"R_nor",connector:"input",index:1}]}])}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(0),s=r(2),n=r(3),a=r(11),o=r(1);var l;t.GraphicalRegister=class extends n.CompactCombinedGraphicalElement{constructor(e,t,r=!1,n=o.GraphicalOr.DEFAULT_HEIGHT,l=!1,u=!1,h){super(e,t*(a.GraphicalDFlipFlop.DEFAULT_HEIGHT+2*i.GraphicalWire.DEFAULT_HEIGHT),r),this.numInBits=t,this.defaultHeight=n,this.mirrorConnectors=l,this.readOnly=u;let p=new Array(t);if(p.fill(!1),h){let e=parseInt(h,16);for(let r=0;r<t;r++)p[r]=!!(1&e),e>>=1}let c=[];for(let e=0;e<t;e++){let r=e*(a.GraphicalDFlipFlop.DEFAULT_HEIGHT+2*i.GraphicalWire.DEFAULT_HEIGHT);c.push(`dff${e} dff init=${p[e]} @20:${r}`+(u?"":` 0<${e}`)+(t<=1&&!u?" 1<1":"")+" 0>>"),u&&c.push(`data_split${e} split init=false @10:dff${e}/i0 >dff${e}/i0`),e>0&&c.push(`split${e} split init=false @0:dff${e}/i1`+(e>=t-1&&!u?` <${t}`:"")+` >dff${e}`+(e>1?` >split${e-1}`:" >p:n~dff0/i1"))}this.wiringDescriptions=s.GrammarParser.parse(c).wiringDescriptions}makeDefaultHeight(){return this.defaultHeight}makeWiringDescriptions(){return this.wiringDescriptions}makeConnectorCoordinates(e){this.height=e;let t=e/this.makeDefaultHeight();return this.width=o.GraphicalOr.getWidth(t*o.GraphicalOr.DEFAULT_HEIGHT),this.lineWidth=o.GraphicalOr.getLineWidth(t*o.GraphicalOr.DEFAULT_HEIGHT),o.GraphicalOr.makeConnectorCoordinates(this.width,this.height,this.numInBits+(this.readOnly?0:1),this.numInBits,this.mirrorConnectors)}makeBaseCoordinates(e,t){return t[0]}makeGraphics(e,t){let r=e/this.makeDefaultHeight();return o.GraphicalOr.makeGraphics(this.height,this.width,"RG",r*o.GraphicalOr.DEFAULT_HEIGHT)}onElement(e,t){}doRedraw(e){o.GraphicalOr.redraw(this.graphics,this.width,this.height,this.lineWidth,l.COMPACT_COLOR)}},function(e){e.COMPACT_COLOR=0}(l=t.GraphicalDecoder||(t.GraphicalDecoder={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(7),s=r(0),n=r(2),a=r(3),o=r(1);class l extends a.CompactCombinedGraphicalElement{constructor(e,t,r=!1,a=!1,l=o.GraphicalOr.DEFAULT_HEIGHT){super(e,2*t*i.GraphicalNor.DEFAULT_HEIGHT+i.GraphicalNor.DEFAULT_HEIGHT,r),this.numInBits=t,this.mirrorConnectors=a,this.defaultHeight=l;let u=[];for(let e=0;e<t;e++){let r=2*(t-1-e)*i.GraphicalNor.DEFAULT_HEIGHT,n=r+i.GraphicalNor.DEFAULT_HEIGHT/2+20,a=`in${e} split @0:${r} <${e} >p:n~in_nor${e}`,o=`in_nor${e} nor i0@20:${n}`;for(let l=0;l<Math.pow(2,t);l++){let h=2*(l+1)*i.GraphicalNor.DEFAULT_HEIGHT+2*e*s.GraphicalWire.DEFAULT_HEIGHT;!(l>>e&1)?l+1>=Math.pow(2,t)?a+=` >${h}:p~p:n~out_nor${l}`:(a+=` >connector_split${e}_${l}`,u.push(a),a=`connector_split${e}_${l} split @${h}:${r} >p:n~out_nor${l}`):l+1>=Math.pow(2,t)?o+=` >${h}:p~p:n~out_nor${l}`:(o+=` >connector_split${e}_${l}`,u.push(o),o=`connector_split${e}_${l} split @${h}:${n} >p:n~out_nor${l}`)}u.push(a),u.push(o)}for(let e=Math.pow(2,t)-1;e>=0;e--){let r=2*(e+1)*i.GraphicalNor.DEFAULT_HEIGHT+2*t*s.GraphicalWire.DEFAULT_HEIGHT,n=2*t*i.GraphicalNor.DEFAULT_HEIGHT;u.push(`out_nor${e} nor @${r}:${n} 0>>`)}u.reverse(),this.wiringDescriptions=n.GrammarParser.parse(u).wiringDescriptions}makeDefaultHeight(){return this.defaultHeight}makeWiringDescriptions(){return this.wiringDescriptions}makeConnectorCoordinates(e){this.height=e;let t=e/this.makeDefaultHeight();return this.width=o.GraphicalOr.getWidth(t*o.GraphicalOr.DEFAULT_HEIGHT),this.lineWidth=o.GraphicalOr.getLineWidth(t*o.GraphicalOr.DEFAULT_HEIGHT),o.GraphicalOr.makeConnectorCoordinates(this.width,this.height,this.numInBits,Math.pow(2,this.numInBits),this.mirrorConnectors)}makeBaseCoordinates(e,t){return t[0]}makeGraphics(e,t){let r=e/this.makeDefaultHeight();return o.GraphicalOr.makeGraphics(this.height,this.width,"DC",r*o.GraphicalOr.DEFAULT_HEIGHT)}onElement(e,t){}doRedraw(e){o.GraphicalOr.redraw(this.graphics,this.width,this.height,this.lineWidth,l.COMPACT_COLOR)}}t.GraphicalDecoder=l,function(e){e.COMPACT_COLOR=0}(l=t.GraphicalDecoder||(t.GraphicalDecoder={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(6);t.Split=class{constructor(e,t,r,i=!1){this.name=e,this.numOutChannels=t,this.numInBits=r,this.initialValue=i,this.inputValueAddressProviders=new Array(r)}getName(){return this.name}getOwnType(){return this.constructor.name}getDelay(){return 0}getChildren(){return[]}readInputFrom(e,t,r){this.inputValueAddressProviders[e]=t.getOutputValueAddressProvider(r)}getNumOutputs(){return this.numOutChannels*this.numInBits}getOutputValueAddressProvider(e){return this.numInBits?()=>this.inputValueAddressProviders[e%this.inputValueAddressProviders.length]():()=>this.fixedValueAddress}getWriteOutputsCalculations(e){return this.fixedValueAddress=new i.ConnectedElement.StaticAddress({space:e,address:0,hint:`static fixed value address for split ${this.getName()}`}),[]}getReadInputsCalculations(){if(this.numInBits)for(let e=0;e<this.inputValueAddressProviders.length;e++)if(!this.inputValueAddressProviders[e])throw new Error(this.getName()+": input "+e+" is not connected");return[]}getUpdateFunctions(){return[]}getInitiallyTrueAddresses(){return!this.numInBits&&this.initialValue?[this.fixedValueAddress]:[]}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(8),s=r(6);t.SourceTerminal=class extends i.LogicElement{constructor(e,t){super(e,0,1,t()),this.source=t}makeCalculations(e,t){return{calculations:[],outputAddresses:[new s.ConnectedElement.StaticAddress({space:t,address:0,hint:`static output address for source terminal ${this.getName()}`})]}}makeUpdateFunctions(){return[{function:(e,t)=>(t[0]=this.source(),!0),interval:1}]}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(31),s=r(5),n=r(0);t.GraphicalSourceTerminal=class extends s.StubGraphicalElement{constructor(e,t){super(e),this.value=t}getDefaultHeight(){return 20}makeConnectorCoordinates(e){return this.radius=e/2,{input:[],output:[{x:0,y:0}]}}makeBaseCoordinates(e,t){return t[0]}makeElement(e,t){return new i.SourceTerminal(this.getName(),()=>this.value)}makeGraphics(e,t){let r=new PIXI.Graphics;return r.interactive=!0,r.on("pointertap",()=>{this.value=!this.value}),r}redraw(e){this.graphics.clear(),this.graphics.beginFill(this.value?n.GraphicalWire.HIGH_COLOR:n.GraphicalWire.LOW_COLOR,1),this.graphics.drawCircle(0,0,this.radius)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(8);t.SinkTerminal=class extends i.LogicElement{constructor(e,t){super(e,1,0),this.sink=t}makeCalculations(e,t){return{calculations:[],outputAddresses:[]}}makeUpdateFunctions(){return[{function:(e,t)=>(this.sink(e[0]),!1),interval:1}]}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(33),s=r(5),n=r(0);t.GraphicalSinkTerminal=class extends s.StubGraphicalElement{constructor(e){super(e)}getDefaultHeight(){return 20}makeConnectorCoordinates(e){return this.radius=e/2,{input:[{x:0,y:0}],output:[]}}makeBaseCoordinates(e,t){return t[0]}makeElement(e,t){return new i.SinkTerminal(this.getName(),e=>{this.value=e})}makeGraphics(e,t){return new PIXI.Graphics}redraw(e){this.graphics.clear(),this.graphics.beginFill(this.value?n.GraphicalWire.HIGH_COLOR:n.GraphicalWire.LOW_COLOR,1),this.graphics.drawCircle(0,0,this.radius)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(8),s=r(6);t.Nor=class extends i.LogicElement{constructor(e,t,r=!1){if(super(e,t,1,r),t<=0)throw new Error(`${this.getName()}: need at least one input`)}makeCalculations(e,t){let r=[];for(let t=0;t<this.numInputs;t++)r.push(new s.ConnectedElement.StaticAddress({space:e,address:t,hint:`static input address for input ${t} of nor ${this.getName()}`}));let i=new s.ConnectedElement.StaticAddress({space:t,address:0,hint:`static output address of nor ${this.getName()}`});return{calculations:[{target:i,value:{type:"NotRule",value:{type:"OrRule",value:r}}}],outputAddresses:[i]}}makeUpdateFunctions(){return[]}}},function(e,t){var r,i;r=this,i=function(){function e(t,r,i){return this.id=++e.highestId,this.name=t,this.symbols=r,this.postprocess=i,this}function t(e,t,r,i){this.rule=e,this.dot=t,this.reference=r,this.data=[],this.wantedBy=i,this.isComplete=this.dot===e.symbols.length}function r(e,t){this.grammar=e,this.index=t,this.states=[],this.wants={},this.scannable=[],this.completed={}}function i(e,t){this.rules=e,this.start=t||this.rules[0].name;var r=this.byName={};this.rules.forEach(function(e){r.hasOwnProperty(e.name)||(r[e.name]=[]),r[e.name].push(e)})}function s(){this.reset("")}function n(e,t,n){if(e instanceof i){var a=e;n=t}else a=i.fromCompiled(e,t);for(var o in this.grammar=a,this.options={keepHistory:!1,lexer:a.lexer||new s},n||{})this.options[o]=n[o];this.lexer=this.options.lexer,this.lexerState=void 0;var l=new r(a,0);this.table=[l];l.wants[a.start]=[],l.predict(a.start),l.process(),this.current=0}return e.highestId=0,e.prototype.toString=function(e){function t(e){return e.literal?JSON.stringify(e.literal):e.type?"%"+e.type:e.toString()}var r=void 0===e?this.symbols.map(t).join(" "):this.symbols.slice(0,e).map(t).join(" ")+" ● "+this.symbols.slice(e).map(t).join(" ");return this.name+" → "+r},t.prototype.toString=function(){return"{"+this.rule.toString(this.dot)+"}, from: "+(this.reference||0)},t.prototype.nextState=function(e){var r=new t(this.rule,this.dot+1,this.reference,this.wantedBy);return r.left=this,r.right=e,r.isComplete&&(r.data=r.build()),r},t.prototype.build=function(){var e=[],t=this;do{e.push(t.right.data),t=t.left}while(t.left);return e.reverse(),e},t.prototype.finish=function(){this.rule.postprocess&&(this.data=this.rule.postprocess(this.data,this.reference,n.fail))},r.prototype.process=function(e){for(var t=this.states,r=this.wants,i=this.completed,s=0;s<t.length;s++){var a=t[s];if(a.isComplete){if(a.finish(),a.data!==n.fail){for(var o=a.wantedBy,l=o.length;l--;){var u=o[l];this.complete(u,a)}if(a.reference===this.index){var h=a.rule.name;(this.completed[h]=this.completed[h]||[]).push(a)}}}else{if("string"!=typeof(h=a.rule.symbols[a.dot])){this.scannable.push(a);continue}if(r[h]){if(r[h].push(a),i.hasOwnProperty(h)){var p=i[h];for(l=0;l<p.length;l++){var c=p[l];this.complete(a,c)}}}else r[h]=[a],this.predict(h)}}},r.prototype.predict=function(e){for(var r=this.grammar.byName[e]||[],i=0;i<r.length;i++){var s=r[i],n=this.wants[e],a=new t(s,0,this.index,n);this.states.push(a)}},r.prototype.complete=function(e,t){var r=e.nextState(t);this.states.push(r)},i.fromCompiled=function(t,r){var s=t.Lexer;t.ParserStart&&(r=t.ParserStart,t=t.ParserRules);var n=new i(t=t.map(function(t){return new e(t.name,t.symbols,t.postprocess)}),r);return n.lexer=s,n},s.prototype.reset=function(e,t){this.buffer=e,this.index=0,this.line=t?t.line:1,this.lastLineBreak=t?-t.col:0},s.prototype.next=function(){if(this.index<this.buffer.length){var e=this.buffer[this.index++];return"\n"===e&&(this.line+=1,this.lastLineBreak=this.index),{value:e}}},s.prototype.save=function(){return{line:this.line,col:this.index-this.lastLineBreak}},s.prototype.formatError=function(e,t){var r=this.buffer;if("string"==typeof r){var i=r.indexOf("\n",this.index);-1===i&&(i=r.length);var s=r.substring(this.lastLineBreak,i),n=this.index-this.lastLineBreak;return t+=" at line "+this.line+" col "+n+":\n\n",t+="  "+s+"\n",t+="  "+Array(n).join(" ")+"^"}return t+" at index "+(this.index-1)},n.fail={},n.prototype.feed=function(e){var t,i=this.lexer;for(i.reset(e,this.lexerState);t=i.next();){var n=this.table[this.current];this.options.keepHistory||delete this.table[this.current-1];var a=this.current+1,o=new r(this.grammar,a);this.table.push(o);for(var l=t.value,u=i.constructor===s?t.value:t,h=n.scannable,p=h.length;p--;){var c=h[p],d=c.rule.symbols[c.dot];if(d.test?d.test(u):d.type?d.type===t.type:d.literal===l){var m=c.nextState({data:u,token:t,isToken:!0,reference:a-1});o.states.push(m)}}if(o.process(),0===o.states.length){var f=this.lexer.formatError(t,"invalid syntax")+"\n";f+="Unexpected "+(t.type?t.type+" token: ":""),f+=JSON.stringify(void 0!==t.value?t.value:t)+"\n";var _=new Error(f);throw _.offset=this.current,_.token=t,_}this.options.keepHistory&&(n.lexerState=i.save()),this.current++}return n&&(this.lexerState=i.save()),this.results=this.finish(),this},n.prototype.save=function(){var e=this.table[this.current];return e.lexerState=this.lexerState,e},n.prototype.restore=function(e){var t=e.index;this.current=t,this.table[t]=e,this.table.splice(t+1),this.lexerState=e.lexerState,this.results=this.finish()},n.prototype.rewind=function(e){if(!this.options.keepHistory)throw new Error("set option `keepHistory` to enable rewinding");this.restore(this.table[e])},n.prototype.finish=function(){var e=[],t=this.grammar.start;return this.table[this.table.length-1].states.forEach(function(r){r.rule.name===t&&r.dot===r.rule.symbols.length&&0===r.reference&&r.data!==n.fail&&e.push(r)}),e.map(function(e){return e.data})},{Parser:n,Grammar:i,Rule:e}},"object"==typeof e&&e.exports?e.exports=i():r.nearley=i()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CombinedElement=class{constructor(e,t){this.name=e,this.inputReceiverDescriptions=[],this.outputSourceDescriptions=[],this.connectedElements=new Array(t.length);let r={},i=[];for(let e=0;e<t.length;e++)this.connectedElements[e]=t[e].element,r[t[e].name]=t[e].element;for(let e=0;e<t.length;e++){let s=t[e],n=s.element;for(let e=0;e<s.inputs.length;e++){let t=s.inputs[e];if("outside"===t.name){for(;t.outputIndex>=i.length;)i.push(void 0);if(i[t.outputIndex])throw new Error(this.name+": input index "+t.outputIndex+" of this combined element is already connected to inside element "+i[t.outputIndex].wiringDescriptionName+" and therefore can not be connected to inside element "+s.name);i[t.outputIndex]={element:n,wiringDescriptionName:s.name,index:e}}else{let i=r[t.name];if(!i)throw new Error(this.name+": unknown element name: "+t.name);n.readInputFrom(e,i,t.outputIndex)}}for(let e of s.externalOutputs)this.outputSourceDescriptions.push({element:n,wiringDescriptionName:s.name,index:e})}for(let e=0;e<i.length;e++){let t=i[e];if(!t)throw new Error(this.name+": input index "+e+" is not connected to any inner element, but higher input index exists");this.inputReceiverDescriptions.push(t)}}getName(){return this.name}getOwnType(){}getDelay(){return 0}getChildren(){return this.connectedElements}readInputFrom(e,t,r){if(!(e<this.inputReceiverDescriptions.length))throw new Error(this.name+": input index "+e+" is out of bounds for this element");{let i=this.inputReceiverDescriptions[e];i.element.readInputFrom(i.index,t,r)}}getNumOutputs(){return this.outputSourceDescriptions.length}getOutputValueAddressProvider(e){let t=this.outputSourceDescriptions[e];return t.element.getOutputValueAddressProvider(t.index)}getWriteOutputsCalculations(e){let t=[];for(let r of this.connectedElements){let i=r.getWriteOutputsCalculations(e);for(t.push(...i);e.next;)e=e.next;e=e.getNew()}return t}getReadInputsCalculations(){let e=[];for(let t of this.connectedElements){let r=t.getReadInputsCalculations();e.push(...r)}return e}getUpdateFunctions(){let e=[];for(let t of this.connectedElements){let r=t.getUpdateFunctions();e.push(...r)}return e}getInitiallyTrueAddresses(){let e=[];for(let t of this.connectedElements){let r=t.getInitiallyTrueAddresses();e.push(...r)}return e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(6);t.Wire=class{constructor(e,t,r=!1,i=1){this.name=e,this.initialValue=r,t<0&&(t=0),this.delay=t,this.inputValueAddressProviders=new Array(i),this.delay&&(this.outputAddresses=new Array(i),this.delayBufferAddresses=new Array(i))}getName(){return this.name}getOwnType(){return this.constructor.name}getDelay(){return this.delay}getChildren(){return[]}readInputFrom(e,t,r){if(e>=this.inputValueAddressProviders.length)throw new Error(this.getName()+": input index "+e+" is out of bounds");this.inputValueAddressProviders[e]=t.getOutputValueAddressProvider(r)}getNumOutputs(){return this.inputValueAddressProviders.length}getOutputValueAddressProvider(e){return this.delay?()=>this.outputAddresses[e]:()=>this.inputValueAddressProviders[e]()}getDelayBufferAddressProvider(e){return()=>this.delayBufferAddresses[e]}getWriteOutputsCalculations(e){for(let e=0;e<this.inputValueAddressProviders.length;e++)if(!this.inputValueAddressProviders[e])throw new Error(this.getName()+": input "+e+" is not connected");if(this.writeOutputCalculations=[],this.delay)for(let t=0;t<this.inputValueAddressProviders.length;t++){let r=new i.ConnectedElement.StaticAddress({space:e,address:t,hint:`wire output address for channel ${t} of ${this.getName()}`});this.outputAddresses[t]=r;let s=new i.ConnectedElement.RotatingAddress({space:e,address:this.inputValueAddressProviders.length+t*this.delay,mod:this.delay,startOffset:0,hint:`wire input address for channel ${t} of ${this.getName()}`});this.delayBufferAddresses[t]=new i.ConnectedElement.RotatingAddress(Object.assign({},s.info,{startOffset:1,hint:`wire delay buffer read address for channel ${t} of ${this.getName()}`})),this.writeOutputCalculations.push({target:s,value:void 0})}return this.writeOutputCalculations}getReadInputsCalculations(){let e=[];if(this.delay)for(let t=0;t<this.inputValueAddressProviders.length;t++){let r=this.inputValueAddressProviders[t]();if(!r)throw new Error(`${this.getName()}: input provider ${t} failed to provide an address`);let i=this.writeOutputCalculations[t];i.value=r,e.push({target:this.outputAddresses[t],value:i.target})}return e}getUpdateFunctions(){return[]}getInitiallyTrueAddresses(){let e=[];if(this.delay&&this.initialValue){for(let t=0;t<this.delayBufferAddresses.length;t++){let r=this.delayBufferAddresses[t];for(let s=0;s<r.info.mod;s++)e.push(new i.ConnectedElement.StaticAddress({space:r.info.space,address:r.info.address+s,hint:`static wire delay buffer address for channel ${t} of ${this.getName()}`}))}e.push(...this.outputAddresses)}return e}}},function(e,t,r){"use strict";var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(s,n){function a(e){try{l(i.next(e))}catch(e){n(e)}}function o(e){try{l(i.throw(e))}catch(e){n(e)}}function l(e){e.done?s(e.value):new r(function(t){t(e.value)}).then(a,o)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=r(9);class n{constructor(e,t,r,i){this.dataSource=e;let s=new Uint8Array([120,86,52,18]);if(305419896!==new Uint32Array(s.buffer)[0])throw new Error("system is not little-endian; this is not implemented");let a=this.makeFunctionBodyCode(t,r,i);this.code=[].concat(n.MAGIC_NUMBER,n.VERSION,this.makeTypeSectionWithHeader(),this.makeImportSectionWithHeader(e),this.makeFunctionSectionWithHeader(),this.makeExportSectionWithHeader(),this.makeCodeSectionWithHeader(a))}instantiate(){return i(this,void 0,void 0,function*(){let e=new WebAssembly.Memory({initial:Math.ceil(this.dataSource.getTargetNumBytes()/n.WASM_PAGE_SIZE),maximum:Math.ceil(this.dataSource.getTargetNumBytes()/n.WASM_PAGE_SIZE)}),t=yield WebAssembly.instantiate(new Uint8Array(this.code),{imports:{memory:e}});this.dataSource.setBuffer(e.buffer);let r=t.instance.exports.step;if(!r)throw new Error(`expected step function to be exported by wasm module, got exports: ${t.instance.exports}`);this.stepFunction=r})}step(e){return this.stepFunction(e)}makeFunctionBodyCode(e,t,r){let i=[];i.push(...n.OPCODE.I32_CONST),i.push(...n.varint(0)),i.push(...n.OPCODE.I64_LOAD),i.push(...n.varuint(3)),i.push(...n.varuint(0)),i.push(...n.OPCODE.SET_LOCAL),i.push(...n.varuint(1)),i.push(...n.OPCODE.BLOCK),i.push(...n.TYPE.EMPTY),i.push(...n.OPCODE.LOOP),i.push(...n.TYPE.EMPTY),i.push(...n.OPCODE.GET_LOCAL),i.push(...n.varuint(0)),i.push(...n.OPCODE.I32_EQZ),i.push(...n.OPCODE.BR_IF),i.push(...n.varuint(1)),i.push(...n.OPCODE.GET_LOCAL),i.push(...n.varuint(0)),i.push(...n.OPCODE.I32_CONST),i.push(...n.varint(1)),i.push(...n.OPCODE.I32_SUB),i.push(...n.OPCODE.SET_LOCAL),i.push(...n.varuint(0)),i.push(...n.OPCODE.GET_LOCAL),i.push(...n.varuint(1)),i.push(...n.OPCODE.I64_CONST),i.push(...n.varint(1)),i.push(...n.OPCODE.I64_ADD),i.push(...n.OPCODE.SET_LOCAL),i.push(...n.varuint(1));for(let t=0;t<e.length;t++){let r=e[t];if(i.push(...n.OPCODE.I32_CONST),i.push(...n.varint(0)),i.push(...n.OPCODE.GET_LOCAL),i.push(...n.varuint(1)),0!==r.startOffset){if(r.startOffset<0||r.startOffset%1!=0)throw new Error(`RotatingAddress.startOffset: expected unsigned integer, got: ${r.startOffset}`);i.push(...n.OPCODE.I64_CONST),i.push(...n.varint(r.startOffset)),i.push(...n.OPCODE.I64_ADD)}i.push(...n.OPCODE.I64_CONST),i.push(...n.varint(r.mod)),i.push(...n.OPCODE.I64_REM_U),i.push(...n.OPCODE.I64_STORE32),i.push(...n.varuint(2)),i.push(...n.varuint(4*r.address))}for(let e=0;e<r.length;e++){let s=r[e];i.push(...this.makeCalculationCode(s,t,e))}return i.push(...n.OPCODE.BR),i.push(...n.varuint(0)),i.push(...n.OPCODE.END),i.push(...n.OPCODE.END),i.push(...n.OPCODE.I32_CONST),i.push(...n.varint(0)),i.push(...n.OPCODE.GET_LOCAL),i.push(...n.varuint(1)),i.push(...n.OPCODE.I64_STORE),i.push(...n.varuint(3)),i.push(...n.varuint(0)),i.push(...n.OPCODE.END),i}makeCalculationCode(e,t,r){if(!e.target)throw new Error(`target-less calculations not implemented: calculation index ${r}: ${e}`);return[].concat(this.makeAddressAddressPushCode(e.target,t),this.makeValueSourceReaderCode(e.value,t),n.OPCODE.I32_STORE8,n.varuint(0),n.varuint(e.target.info.address))}makeAddressAddressPushCode(e,t){switch(e.type){case"StaticAddress":return[].concat(n.OPCODE.I32_CONST,n.varint(0));case"RotatingAddress":{let r=t[e.info.mod][e.info.startOffset];return this.makeModuloResultPushCode(r)}default:throw new s.NeverError(e,"unexpected value source type")}}makeModuloResultPushCode(e){return[].concat(n.OPCODE.I32_CONST,n.varint(0),n.OPCODE.I32_LOAD,n.varuint(0),n.varuint(4*e))}makeValueSourceReaderCode(e,t){switch(e.type){case"StaticAddress":case"RotatingAddress":return this.makeAddressReaderCode(e,t);case"AndRule":case"OrRule":return this.makeRuleReaderCode(e,t);case"NotRule":return this.makeNotRuleReaderCode(e,t);case"AlternatingValue":return this.makeAlternatingValueReaderCode(e,t);default:throw new s.NeverError(e,"unexpected value source type")}}makeAddressReaderCode(e,t){return[].concat(this.makeAddressAddressPushCode(e,t),n.OPCODE.I32_LOAD8_U,n.varuint(0),n.varuint(e.info.address))}makeRuleReaderCode(e,t){let r,i=[];switch(e.type){case"AndRule":r=n.OPCODE.I32_AND;break;case"OrRule":r=n.OPCODE.I32_OR;break;default:throw new s.NeverError(e,"unexpected rule type")}for(let s=0;s<e.value.length;s++){let n=e.value[s];i.push(...this.makeValueSourceReaderCode(n,t)),s>0&&i.push(...r)}return i}makeNotRuleReaderCode(e,t){return[].concat(this.makeValueSourceReaderCode(e.value,t),n.OPCODE.I32_EQZ)}makeAlternatingValueReaderCode(e,t){let r=t[e.offDuration+e.onDuration][e.startOffset];return[].concat(this.makeModuloResultPushCode(r),n.OPCODE.I32_CONST,n.varint(e.onDuration),n.OPCODE.I32_LT_U)}makeSectionHeaderWithPayload(e,t){return[].concat(e,n.varuint(t.length),t)}makeTypeSectionWithHeader(){let e=[].concat(n.varuint(1),n.TYPE.FUNC,n.varuint(1),n.TYPE.I32,0);return this.makeSectionHeaderWithPayload(n.SECTION_TYPE.TYPE,e)}makeImportSectionWithHeader(e){let t=[].concat(n.varuint(1),n.varuint32LengthAndBytes("imports"),n.varuint32LengthAndBytes("memory"),n.EXTERNAL_KIND.MEMORY,1,n.varuint(Math.ceil(e.getTargetNumBytes()/n.WASM_PAGE_SIZE)),n.varuint(Math.ceil(e.getTargetNumBytes()/n.WASM_PAGE_SIZE)));return this.makeSectionHeaderWithPayload(n.SECTION_TYPE.IMPORT,t)}makeFunctionSectionWithHeader(){let e=[].concat(n.varuint(1),n.varuint(0));return this.makeSectionHeaderWithPayload(n.SECTION_TYPE.FUNCTION,e)}makeExportSectionWithHeader(){let e=[].concat(n.varuint(1),n.varuint32LengthAndBytes("step"),n.EXTERNAL_KIND.FUNCTION,n.varuint(0));return this.makeSectionHeaderWithPayload(n.SECTION_TYPE.EXPORT,e)}makeCodeSectionWithHeader(e){let t=[].concat(n.varuint(1),n.varuint(1),n.TYPE.I64,e),r=[].concat(n.varuint(1),n.varuint(t.length),t);return this.makeSectionHeaderWithPayload(n.SECTION_TYPE.CODE,r)}}t.WasmInstance=n,function(e){function t(e){if(e<0||e%1!=0)throw new Error(`varuint: expected unsigned integer, got: ${e}`);let t=[];for(;;){let r=127&e;if(0!==(e>>=7)&&(r|=128),t.push(r),0===e)break}return t}function r(e){return e.split("").map(e=>e.charCodeAt(0))}e.WASM_PAGE_SIZE=65536,e.MAGIC_NUMBER=r("\0asm"),e.VERSION=[1,0,0,0],e.TYPE={I32:[127],I64:[126],F32:[125],F64:[124],ANYFUNC:[112],FUNC:[96],EMPTY:[64]},e.EXTERNAL_KIND={FUNCTION:[0],MEMORY:[2]},e.SECTION_TYPE={TYPE:[1],IMPORT:[2],FUNCTION:[3],TABLE:[4],MEMORY:[5],GLOBAL:[6],EXPORT:[7],START:[8],ELEMENT:[9],CODE:[10],DATA:[11]},e.OPCODE={UNREACHABLE:[0],NOP:[1],BLOCK:[2],LOOP:[3],IF:[4],ELSE:[5],END:[11],BR:[12],BR_IF:[13],BR_TABLE:[14],RETURN:[15],GET_LOCAL:[32],SET_LOCAL:[33],TEE_LOCAL:[34],GET_GLOBAL:[35],SET_GLOBAL:[36],I32_LOAD:[40],I64_LOAD:[41],I32_LOAD8_U:[45],I32_STORE:[54],I64_STORE:[55],I32_STORE8:[58],I64_STORE32:[62],I32_CONST:[65],I64_CONST:[66],I32_EQZ:[69],I32_LT_U:[73],I64_EQZ:[80],I32_SUB:[107],I32_AND:[113],I32_OR:[114],I64_ADD:[124],I64_SUB:[125],I64_REM_U:[130],I64_EXTEND_U_I32:[173]},e.varuint=t,e.varint=function(e){if(e%1!=0)throw new Error(`varuint: expected signed integer, got: ${e}`);let t=[];for(;;){let r=127&e,i=0==(e>>=7)&&0==(64&r)||-1===e&&0!=(64&r);if(i||(r|=128),t.push(r),i)break}return t},e.bytes=r,e.varuint32LengthAndBytes=function(e){let i=r(e);return t(i.length).concat(i)}}(n=t.WasmInstance||(t.WasmInstance={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(9),s=2;class n{constructor(e,t,r){this.targetNumBytes=e,this.moduloOperationsMap=r,this.n=-1,this.addressesOffset=s,this.numAddresses=t.length,this.dataOffset=4*(this.addressesOffset+this.numAddresses),this.numData=e-this.dataOffset}getTargetNumBytes(){return this.targetNumBytes}setBuffer(e){this.array=new Uint8Array(e),this.addressArray=new Uint32Array(e)}getAddressValueReader(e){if("StaticAddress"===e.type){let t=e.info.address;return()=>1===this.array[t]}if("RotatingAddress"===e.type){const t=e.info.mod,r=e.info.address,i=this.moduloOperationsMap[e.info.mod][e.info.startOffset];return(e=0)=>1===this.array[r+(this.addressArray[i]+e)%t]}throw new i.NeverError(e,"unexpected address type")}getAddressValueWriter(e){if("StaticAddress"===e.type){let t=e.info.address;return e=>this.array[t]=e?1:0}if("RotatingAddress"===e.type){const t=e.info.mod,r=e.info.address,i=this.moduloOperationsMap[e.info.mod][e.info.startOffset];return(e,s=0)=>this.array[r+(this.addressArray[i]+s)%t]=e?1:0}throw new i.NeverError(e,"unexpected address type")}}t.DataSource=n,function(e){e.RotatingAddressInstance=class{}}(n=t.DataSource||(t.DataSource={}))},function(e,t,r){"use strict";var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(s,n){function a(e){try{l(i.next(e))}catch(e){n(e)}}function o(e){try{l(i.throw(e))}catch(e){n(e)}}function l(e){e.done?s(e.value):new r(function(t){t(e.value)}).then(a,o)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=r(6),n=r(40),a=r(9),o=r(39);t.Circuit=class{constructor(e){this.element=e}init(e=!1){return i(this,void 0,void 0,function*(){let t=new s.ConnectedElement.Space;this.writeOutputsCalculations=this.element.getWriteOutputsCalculations(t),this.readInputsCalculations=this.element.getReadInputsCalculations();let r=this.element.getUpdateFunctions();this.initiallyTrueAddresses=this.element.getInitiallyTrueAddresses();let i={},a=[],l=this.makeFunctionProvider(this.readInputsCalculations,a,i),u=this.makeFunctionProvider(this.writeOutputsCalculations,a,i),h=t;for(;h;){for(let e of h.addresses)this.makeValueSourceAccessor(e,a,i,!0);h=h.next}for(t.offset=8+4*a.length;t.calculateSizeAndOffsetNext(),t.next;)t=t.next;this.updateModulosFunction=this.makeModulosUpdateFunction(a),this.readInputsFunction=l(),this.writeOutputsFunction=u(),e&&(console.log("updateModulosFunction",this.updateModulosFunction.toString()),console.log("readInputsFunction",this.readInputsFunction.toString()),console.log("writeOutputsFunction",this.writeOutputsFunction.toString()));let p=[...this.readInputsCalculations,...this.writeOutputsCalculations];this.dataSource=new n.DataSource(t.offset+t.size,a,i);try{this.wasmInstance=new o.WasmInstance(this.dataSource,a,i,p),yield this.wasmInstance.instantiate(),console.log("using wasm")}catch(e){console.log("wasm failed, falling back to javascript function; error:"),console.log(e.stack),this.wasmInstance=void 0,this.dataSource.setBuffer(new ArrayBuffer(this.dataSource.getTargetNumBytes()))}for(let e=0;e<8;e++)this.dataSource.array[e]=255;for(let e of this.initiallyTrueAddresses)this.dataSource.array[e.info.address]=1;this.updateFunctionInstances=new Array(r.length);for(let e=0;e<r.length;e++){let t=r[e],i=new Array(t.inputAddresses.length);for(let e=0;e<t.inputAddresses.length;e++)i[e]=this.dataSource.getAddressValueReader(t.inputAddresses[e]);let s=new Array(t.outputAddresses.length);for(let e=0;e<t.outputAddresses.length;e++)s[e]=this.dataSource.getAddressValueWriter(t.outputAddresses[e]);this.updateFunctionInstances[e]={updateFunction:t,addressReaders:i,addressWriters:s,stepsLeft:0}}this.wasmInstance?this.doSteps=(e=>this.wasmInstance.step(e)):this.doSteps=(e=>{for(let t=0;t<e;t++)this.dataSource.n++,this.updateModulosFunction(this.dataSource.addressArray,this.dataSource.n),this.readInputsFunction(this.dataSource.array,this.dataSource.addressArray,this.dataSource.n),this.writeOutputsFunction(this.dataSource.array,this.dataSource.addressArray,this.dataSource.n)})})}getModuloOperationIndex(e,t,r,i){if(t[r]||(t[r]={}),void 0===t[r][i]){let s=e.length+2;t[r][i]=s,e.push({space:void 0,startOffset:i,mod:r,address:s,hint:`modulo operation ${s}: ((n + ${i}) % ${r})`})}return t[r][i]}makeFunctionProvider(e,t,r){let i=[];for(let s of e){let e=this.makeLine(s,t,r);i.push(e)}return()=>new Function("d","a","n",i.map(e=>e()).join("\n"))}makeLine(e,t,r){let i=void 0;e.target&&(i=this.makeValueSourceAccessor(e.target,t,r));let s=this.makeValueSourceAccessor(e.value,t,r,!0);return()=>{let e="";return i&&(e+=`${i()} = ((`),e+=`${s()}`,i&&(e+=") ? 1 : 0)"),e+=";"}}makeValueSourceAccessor(e,t,r,i=!1){switch(e.type){case"StaticAddress":return this.makeStaticAddressAccessor(e,i);case"RotatingAddress":return this.makeRotatingAddressAccessor(e,t,r,i);case"AndRule":return this.makeAndRuleAccessor(e,t,r);case"OrRule":return this.makeOrRuleAccessor(e,t,r);case"NotRule":return this.makeNotRuleAccessor(e,t,r);case"AlternatingValue":return this.makeAlternatingValueAccessor(e,t,r);default:throw new a.NeverError(e,"unexpected value source type")}}makeStaticAddressAccessor(e,t=!1){return()=>`d[${e.info.address}] /*${e.info.hint}*/`+(t?" === 1":"")}makeRotatingAddressAccessor(e,t,r,i=!1){let s=this.getModuloOperationIndex(t,r,e.info.mod,e.info.startOffset);return()=>`d[${e.info.address} + a[${s}]] /*${e.info.hint}*/`+(i?" === 1":"")}makeAndRuleAccessor(e,t,r){let i=e.value.map(e=>this.makeValueSourceAccessor(e,t,r,!0));return()=>i.map(e=>`(${e()})`).join(" && ")}makeOrRuleAccessor(e,t,r){let i=e.value.map(e=>this.makeValueSourceAccessor(e,t,r,!0));return()=>i.map(e=>`(${e()})`).join(" || ")}makeNotRuleAccessor(e,t,r){let i=this.makeValueSourceAccessor(e.value,t,r,!0);return()=>`!(${i()})`}makeAlternatingValueAccessor(e,t,r){let i=e.offDuration+e.onDuration,s=this.getModuloOperationIndex(t,r,i,e.startOffset);return()=>`a[${s}] < ${e.onDuration}`}makeModulosUpdateFunction(e){let t=[];for(let r of e)t.push(`a[${r.address}] = ((n + ${r.startOffset}) % ${r.mod}); /*${r.hint}*/`);return new Function("a","n",t.join("\n"))}step(e=1){for(let t of this.updateFunctionInstances){if(t.stepsLeft<=0){for(let e=0;e<t.addressReaders.length;e++)t.updateFunction.inputValues[e]=t.addressReaders[e]();if(t.updateFunction.function())for(let e=0;e<t.addressWriters.length;e++)t.addressWriters[e](t.updateFunction.outputValues[e]);t.stepsLeft=t.updateFunction.interval}t.stepsLeft-=e}this.doSteps(e)}}},function(e,t,r){"use strict";var i=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(s,n){function a(e){try{l(i.next(e))}catch(e){n(e)}}function o(e){try{l(i.throw(e))}catch(e){n(e)}}function l(e){e.done?s(e.value):new r(function(t){t(e.value)}).then(a,o)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const s=r(41),n=r(0);t.GraphicalCircuit=class{constructor(e,t=!1,r=50,i=n.GraphicalWire.DEFAULT_DELAY_PER_WINDOW_HEIGHT,s=!1,a){this.graphicalElement=e,this.disableGraphics=t,this.stepsPerSecond=r,this.delayPerWindowHeight=i,this.echoData=s,this.cyclesPerStep=a}init(e=!1){return i(this,void 0,void 0,function*(){let t,r;try{t=window.innerWidth,r=window.innerHeight}catch(e){t=800,r=600}n.GraphicalWire.DELAY_PER_PIXEL=this.delayPerWindowHeight/r;let i=[{x:0,y:0}];if(this.graphicalElement.initConnectorCoordinates(r),this.graphicalElement.initBaseCoordinates(r,i),this.graphicalElement.initElement(r,i),this.circuit=new s.Circuit(this.graphicalElement.element),yield this.circuit.init(e),this.disableGraphics||this.graphicalElement.initGraphics(r,i,this.circuit.dataSource),!this.disableGraphics){let e=this.graphicalElement.graphics;if(!e)throw new Error("graphical element fails to provide graphics");this.app=new PIXI.Application({width:t,height:r,antialias:!0,transparent:!0}),this.app.stage.addChild(e);let i=1e3/this.stepsPerSecond,s=-1,n=this.app.ticker.add(()=>{if(s<0)return void(s=0);for(s+=n.elapsedMS;s>=i;)s-=i,this.echoData&&(console.log(`data source after step ${this.circuit.dataSource.n}:`),console.log("addresses",this.circuit.dataSource.addressArray),console.log("data",this.circuit.dataSource.array)),this.circuit.step(this.cyclesPerStep);let e=s/i;this.graphicalElement.redraw(e)})}})}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=r(42),s=r(4),n=r(2);let a=window.location.hash.slice(1),o=!1;"vollgas"===(a=decodeURIComponent(a))&&(o=!0,a="fast"),a&&"fast"!==a||(a=("fast"===a?"fast:":"")+"681CEC00");let l=!1;if(a.startsWith("fast:")&&(a=a.substring("fast:".length),l=!0),a.match(/^[0-9A-Fa-f]+$/)&&a.length%8==0){let e="",t="";l&&(e=" instructionDelay=40 aluDelay=100 registersDelay=20",t=" delayPerWindowHeight=0 stepsPerSecond=2000"),a=`height=1000${t}  x micro16 code=${a}${e} @100:50`}let u=n.GrammarParser.parse([a]);u.disableGraphics&&(o=!0);let h=new s.CombinedGraphicalElement("parsed_element",u.height,u.wiringDescriptions),p=new i.GraphicalCircuit(h,o,u.stepsPerSecond,u.delayPerWindowHeight,u.echoData,u.cyclesPerStep);p.init(u.echoFunctions).then(()=>{if(o){const e=u.cyclesPerStep||160,t=Math.floor(1e4/e);let r=()=>{let i=performance.now();for(let r=0;r<t;r++)p.circuit.step(e);let s=performance.now();const n=Math.floor(s-i),a=n/1e3,o=e*t,l=Math.floor(o/160),u=Math.floor(l/a);console.log(`${n} ms for ${o} steps; ${o}/160 = ${l} instructions; ${l}/${a} = ${u} instructions per second`);let h=window.document.getElementById("ips");h&&(h.innerHTML=`${u}`),setTimeout(r,0)};r()}else document.body.appendChild(p.app.view)})}]);